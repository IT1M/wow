<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة تسجيل الزوار - MAIS مع الذكاء الاصطناعي</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .ai-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 2;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .language-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            padding: 30px;
        }

        .nav-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            transform: translateY(-3px);
        }

        .tab-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .tab-btn.active:hover {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2E8B57;
            background: white;
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
            transform: translateY(-2px);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .ai-analysis-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            display: none;
        }

        .ai-analysis-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }

        .loading-ai {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            padding: 20px;
        }

        .loading-ai::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .natural-search {
            background: #e8f5e8;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .natural-search h3 {
            color: #2E8B57;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .natural-search input {
            width: 100%;
            padding: 15px;
            border: 2px solid #2E8B57;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .search-suggestions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .suggestion-btn {
            background: #2E8B57;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .suggestion-btn:hover {
            background: #1e5e3e;
            transform: translateY(-2px);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-ai {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .stat-card p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stat-card.active-visitors {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .stat-card.checked-out {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        }

        .ai-insights {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
        }

        .search-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .visitors-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #e9ecef;
        }

        .table th {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-checked-out {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2E8B57;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            color: #2E8B57;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .modal p {
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .visitor-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #2E8B57;
        }

        .visitor-card h4 {
            color: #2E8B57;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .visitor-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .visitor-detail {
            font-size: 0.9rem;
            color: #666;
        }

        .visitor-detail strong {
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkout-btn {
            background: #ffc107;
            color: #212529;
        }

        .checkout-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideInRight 0.5s ease;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        .notification.error {
            background: #dc3545;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .ai-report-content {
            text-align: right;
            line-height: 1.8;
            color: #333;
        }

        .ai-report-content h3 {
            color: #2E8B57;
            margin: 20px 0 10px 0;
            border-bottom: 2px solid #2E8B57;
            padding-bottom: 5px;
        }

        .ai-report-content ul {
            margin: 15px 0;
            padding-right: 20px;
        }

        .ai-report-content li {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .table {
                font-size: 0.9rem;
            }
            
            .table th,
            .table td {
                padding: 10px 8px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .ai-badge {
                position: static;
                margin: 10px auto;
                display: inline-block;
            }

            .language-toggle {
                left: auto;
                right: 20px;
                top: auto;
                bottom: 20px;
            }
        }

        .table-responsive {
            overflow-x: auto;
        }

        /* English styles */
        .container[dir="ltr"] {
            direction: ltr;
        }

        .container[dir="ltr"] .table th,
        .container[dir="ltr"] .table td {
            text-align: left;
        }

        .container[dir="ltr"] .language-toggle {
            left: auto;
            right: 20px;
        }

        .container[dir="ltr"] .visitor-card {
            border-left: none;
            border-right: 5px solid #2E8B57;
        }

        .container[dir="ltr"] .notification {
            right: auto;
            left: 20px;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .container[dir="ltr"] .notification {
            animation: slideInLeft 0.5s ease;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-section {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .date-filter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .ai-powered-section {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .ai-powered-section h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .ai-features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .ai-feature-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .ai-feature-card h4 {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .ai-feature-card p {
            font-size: 0.9rem;
            opacity: 0.9;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <header class="header">
            <div class="ai-badge" id="aiBadge">مدعوم بالذكاء الاصطناعي</div>
            <button class="language-toggle" onclick="toggleLanguage()">
                <span id="langText">English</span>
            </button>
            <h1 id="headerTitle">نظام إدارة تسجيل الزوار مع الذكاء الاصطناعي</h1>
            <p id="headerSubtitle">شركة MAIS للمنتجات الطبية</p>
        </header>

        <main class="main-content">
            <!-- قسم مميزات الذكاء الاصطناعي -->
            <div class="ai-powered-section">
                <h2 id="aiSectionTitle">مميزات الذكاء الاصطناعي المدمجة</h2>
                <div class="ai-features-grid">
                    <div class="ai-feature-card">
                        <h4 id="aiFeature1Title">تحليل ملف الزائر</h4>
                        <p id="aiFeature1Desc">تحليل تلقائي لمعلومات الزائر والشركة لتقديم رؤى قيمة</p>
                    </div>
                    <div class="ai-feature-card">
                        <h4 id="aiFeature2Title">البحث بالذكاء الاصطناعي</h4>
                        <p id="aiFeature2Desc">البحث باللغة الطبيعية للوصول السريع للمعلومات</p>
                    </div>
                    <div class="ai-feature-card">
                        <h4 id="aiFeature3Title">تقارير ذكية</h4>
                        <p id="aiFeature3Desc">إنشاء تقارير مفصلة ورؤى تحليلية بالذكاء الاصطناعي</p>
                    </div>
                    <div class="ai-feature-card">
                        <h4 id="aiFeature4Title">تصنيف الزيارات</h4>
                        <p id="aiFeature4Desc">تصنيف تلقائي لأسباب الزيارات وإنشاء إحصائيات دقيقة</p>
                    </div>
                </div>
            </div>

            <nav class="nav-tabs">
                <button class="tab-btn active" onclick="showTab('register')" id="registerTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    تسجيل زائر جديد
                </button>
                <button class="tab-btn" onclick="showTab('visitors')" id="visitorsTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                    </svg>
                    سجل الزوار والإحصائيات
                </button>
                <button class="tab-btn" onclick="showTab('aiInsights')" id="aiInsightsTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    رؤى الذكاء الاصطناعي
                </button>
            </nav>

            <div id="successMessage" class="success-message" style="display: none;"></div>

            <!-- تسجيل زائر جديد -->
            <div id="register" class="tab-content active">
                <form id="visitorForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fullName" id="fullNameLabel">الاسم الكامل</label>
                            <input type="text" id="fullName" name="fullName" placeholder="ادخل الاسم الكامل" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" id="phoneLabel">رقم الهاتف</label>
                            <input type="tel" id="phone" name="phone" placeholder="ادخل رقم الهاتف" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="idType" id="idTypeLabel">نوع الهوية</label>
                            <select id="idType" name="idType" required>
                                <option value="">اختر نوع الهوية</option>
                                <option value="national">هوية وطنية</option>
                                <option value="passport">جواز سفر</option>
                                <option value="residence">إقامة</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="idNumber" id="idNumberLabel">رقم الهوية</label>
                            <input type="text" id="idNumber" name="idNumber" placeholder="ادخل رقم الهوية" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="company" id="companyLabel">الشركة/المؤسسة</label>
                            <input type="text" id="company" name="company" placeholder="ادخل اسم الشركة" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="position" id="positionLabel">المنصب</label>
                            <input type="text" id="position" name="position" placeholder="ادخل المنصب">
                        </div>
                        
                        <div class="form-group">
                            <label for="visitReason" id="visitReasonLabel">سبب الزيارة</label>
                            <select id="visitReason" name="visitReason" required>
                                <option value="">اختر سبب الزيارة</option>
                                <option value="business">اجتماع عمل</option>
                                <option value="consultation">استشارة طبية</option>
                                <option value="meeting">اجتماع</option>
                                <option value="delivery">تسليم</option>
                                <option value="maintenance">صيانة</option>
                                <option value="training">تدريب</option>
                                <option value="interview">مقابلة</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="employeeOffice" id="employeeOfficeLabel">الموظف/المكتب المُراد زيارته</label>
                            <input type="text" id="employeeOffice" name="employeeOffice" placeholder="ادخل اسم الموظف أو المكتب" required>
                        </div>

                        <div class="form-group">
                            <label for="email" id="emailLabel">البريد الإلكتروني</label>
                            <input type="email" id="email" name="email" placeholder="ادخل البريد الإلكتروني">
                        </div>

                        <div class="form-group">
                            <label for="nationality" id="nationalityLabel">الجنسية</label>
                            <input type="text" id="nationality" name="nationality" placeholder="ادخل الجنسية">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes" id="notesLabel">ملاحظات إضافية</label>
                        <textarea id="notes" name="notes" placeholder="أضف أي ملاحظات إضافية هنا..."></textarea>
                    </div>

                    <!-- قسم تحليل الذكاء الاصطناعي -->
                    <div id="aiAnalysisSection" class="ai-analysis-section">
                        <h3 id="aiAnalysisTitle">تحليل الذكاء الاصطناعي للزائر</h3>
                        <div id="aiAnalysisContent" class="ai-analysis-content">
                            <div class="loading-ai" id="aiAnalysisLoading">
                                <span id="aiAnalysisLoadingText">جاري تحليل معلومات الزائر...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            تسجيل الزائر
                        </button>
                        <button type="button" class="btn btn-ai" onclick="analyzeVisitor()" id="analyzeBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            تحليل بالذكاء الاصطناعي
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()" id="clearBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            مسح البيانات
                        </button>
                    </div>
                </form>
            </div>

            <!-- سجل الزوار والإحصائيات -->
            <div id="visitors" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalVisitors">0</h3>
                        <p id="totalLabel">إجمالي الزوار</p>
                    </div>
                    <div class="stat-card active-visitors">
                        <h3 id="activeVisitors">0</h3>
                        <p id="activeLabel">زوار نشطون</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="todayVisitors">0</h3>
                        <p id="todayLabel">زوار اليوم</p>
                    </div>
                    <div class="stat-card checked-out">
                        <h3 id="checkedOutVisitors">0</h3>
                        <p id="checkedOutLabel">تمت زيارتهم</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="weekVisitors">0</h3>
                        <p id="weekLabel">زوار هذا الأسبوع</p>
                    </div>
                    <div class="stat-card ai-insights">
                        <h3 id="aiInsightsCount">--</h3>
                        <p id="aiInsightsLabel">رؤى الذكاء الاصطناعي</p>
                    </div>
                </div>

                <!-- البحث بالذكاء الاصطناعي -->
                <div class="natural-search">
                    <h3 id="naturalSearchTitle">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        البحث بالذكاء الاصطناعي
                    </h3>
                    <input type="text" id="naturalSearchInput" placeholder="اسأل عن الزوار، مثال: أظهر لي زوار شركة X الأسبوع الماضي">
                    <div class="search-suggestions">
                        <button class="suggestion-btn" onclick="setNaturalSearch('زوار اليوم')">زوار اليوم</button>
                        <button class="suggestion-btn" onclick="setNaturalSearch('الزوار النشطون')">الزوار النشطون</button>
                        <button class="suggestion-btn" onclick="setNaturalSearch('زوار الأسبوع الماضي')">زوار الأسبوع الماضي</button>
                        <button class="suggestion-btn" onclick="setNaturalSearch('زيارات الصيانة')">زيارات الصيانة</button>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-ai" onclick="performNaturalSearch()" id="naturalSearchBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                            بحث ذكي
                        </button>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="btn btn-info" onclick="showActiveVisitors()" id="showActiveBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        عرض الزوار النشطون
                    </button>
                    <button class="btn btn-warning" onclick="showTodayVisitors()" id="showTodayBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                        </svg>
                        زوار اليوم
                    </button>
                    <button class="btn btn-secondary" onclick="showAllVisitors()" id="showAllBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                        </svg>
                        جميع الزوار
                    </button>
                </div>

                <div class="filter-section">
                    <h3 id="filterTitle">تصفية النتائج</h3>
                    <div class="date-filter">
                        <div class="form-group">
                            <label for="dateFrom" id="dateFromLabel">من تاريخ</label>
                            <input type="date" id="dateFrom">
                        </div>
                        <div class="form-group">
                            <label for="dateTo" id="dateToLabel">إلى تاريخ</label>
                            <input type="date" id="dateTo">
                        </div>
                        <div class="form-group">
                            <label for="statusFilter" id="statusFilterLabel">حالة الزيارة</label>
                            <select id="statusFilter">
                                <option value="">جميع الحالات</option>
                                <option value="active">نشط</option>
                                <option value="checked-out">تمت الزيارة</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="search-section">
                    <h3 id="searchTitle">البحث المتقدم</h3>
                    <div class="search-grid">
                        <div class="form-group">
                            <label for="searchName" id="searchNameLabel">البحث بالاسم</label>
                            <input type="text" id="searchName" placeholder="ادخل الاسم...">
                        </div>
                        <div class="form-group">
                            <label for="searchPhone" id="searchPhoneLabel">البحث برقم الهاتف</label>
                            <input type="text" id="searchPhone" placeholder="ادخل رقم الهاتف...">
                        </div>
                        <div class="form-group">
                            <label for="searchCompany" id="searchCompanyLabel">البحث بالشركة</label>
                            <input type="text" id="searchCompany" placeholder="ادخل اسم الشركة...">
                        </div>
                        <div class="form-group">
                            <label for="searchEmployee" id="searchEmployeeLabel">البحث بالموظف/المكتب</label>
                            <input type="text" id="searchEmployee" placeholder="ادخل اسم الموظف...">
                        </div>
                        <div class="form-group">
                            <label for="searchReason" id="searchReasonLabel">البحث بسبب الزيارة</label>
                            <select id="searchReason">
                                <option value="">جميع الأسباب</option>
                                <option value="business">اجتماع عمل</option>
                                <option value="consultation">استشارة طبية</option>
                                <option value="meeting">اجتماع</option>
                                <option value="delivery">تسليم</option>
                                <option value="maintenance">صيانة</option>
                                <option value="training">تدريب</option>
                                <option value="interview">مقابلة</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="searchVisitors()" id="searchBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                            بحث
                        </button>
                        <button class="btn btn-secondary" onclick="clearSearch()" id="clearSearchBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            مسح البحث
                        </button>
                    </div>
                </div>

                <div class="export-options">
                    <button class="btn btn-info" onclick="exportToPDF()" id="exportBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        تصدير PDF
                    </button>
                    <button class="btn btn-ai" onclick="generateAIReport()" id="aiReportBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        تقرير ذكي
                    </button>
                    <button class="btn btn-info" onclick="exportToCSV()" id="exportCSVBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        تصدير CSV
                    </button>
                    <button class="btn btn-danger" onclick="confirmClearAll()" id="clearAllBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                        </svg>
                        مسح جميع البيانات
                    </button>
                </div>

                <div class="visitors-table">
                    <div id="loadingIndicator" class="loading" style="display: none;">
                        <span id="loadingText">جاري تحميل البيانات...</span>
                    </div>
                    <div id="emptyState" class="empty-state" style="display: none;">
                        <h3 id="emptyTitle">لا توجد سجلات</h3>
                        <p id="emptyMessage">لم يتم العثور على أي زوار مسجلين</p>
                    </div>
                    <div id="visitorsDisplay"></div>
                </div>
            </div>

            <!-- رؤى الذكاء الاصطناعي -->
            <div id="aiInsights" class="tab-content">
                <div class="ai-powered-section">
                    <h2 id="aiInsightsPageTitle">رؤى وتحليلات الذكاء الاصطناعي</h2>
                    <p id="aiInsightsPageDesc">استكشف الرؤى المدعومة بالذكاء الاصطناعي حول بيانات الزوار</p>
                </div>

                <div class="form-actions">
                    <button class="btn btn-ai" onclick="generateAIInsights()" id="generateInsightsBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        إنشاء رؤى ذكية
                    </button>
                    <button class="btn btn-ai" onclick="generateWeeklyReport()" id="weeklyReportBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        تقرير أسبوعي ذكي
                    </button>
                    <button class="btn btn-ai" onclick="generateTrendAnalysis()" id="trendAnalysisBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                        </svg>
                        تحليل الاتجاهات
                    </button>
                </div>

                <div id="aiInsightsContent" class="visitors-table">
                    <div class="empty-state">
                        <h3 id="aiEmptyTitle">لا توجد رؤى حالياً</h3>
                        <p id="aiEmptyMessage">انقر على أحد الأزرار أعلاه لإنشاء رؤى ذكية</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal للتأكيد -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">تأكيد الحذف</h2>
            <p id="modalMessage">هل أنت متأكد من أنك تريد حذف هذا السجل؟</p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="executeDelete()" id="confirmDeleteBtn">نعم، احذف</button>
                <button class="btn btn-secondary" onclick="closeModal()" id="cancelBtn">إلغاء</button>
            </div>
        </div>
    </div>

    <!-- Modal للتقرير الذكي -->
    <div id="aiReportModal" class="modal">
        <div class="modal-content">
            <h2 id="aiReportModalTitle">التقرير الذكي</h2>
            <div id="aiReportContent" class="ai-report-content">
                <div class="loading-ai">
                    <span>جاري إنشاء التقرير الذكي...</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-info" onclick="downloadAIReport()" id="downloadReportBtn" style="display: none;">تحميل التقرير</button>
                <button class="btn btn-secondary" onclick="closeAIReportModal()" id="closeReportBtn">إغلاق</button>
            </div>
        </div>
    </div>

    <script>
        // إعدادات Gemini API
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
        const GEMINI_API_KEY = 'AIzaSyCV3Kb2rHMQoyAiYkrAFA82UlcGbYAAC0M';

        // اللغة الحالية
        let currentLanguage = 'ar';
        
        // المتغيرات العامة
        let visitors = JSON.parse(localStorage.getItem('visitors')) || [];
        let deleteIndex = -1;
        let filteredVisitors = [...visitors];
        let currentFilter = 'all';
        let aiReportContent = '';

        // النصوص باللغتين
        const translations = {
            ar: {
                headerTitle: 'نظام إدارة تسجيل الزوار مع الذكاء الاصطناعي',
                headerSubtitle: 'شركة MAIS للمنتجات الطبية',
                aiBadge: 'مدعوم بالذكاء الاصطناعي',
                aiSectionTitle: 'مميزات الذكاء الاصطناعي المدمجة',
                aiFeature1Title: 'تحليل ملف الزائر',
                aiFeature1Desc: 'تحليل تلقائي لمعلومات الزائر والشركة لتقديم رؤى قيمة',
                aiFeature2Title: 'البحث بالذكاء الاصطناعي',
                aiFeature2Desc: 'البحث باللغة الطبيعية للوصول السريع للمعلومات',
                aiFeature3Title: 'تقارير ذكية',
                aiFeature3Desc: 'إنشاء تقارير مفصلة ورؤى تحليلية بالذكاء الاصطناعي',
                aiFeature4Title: 'تصنيف الزيارات',
                aiFeature4Desc: 'تصنيف تلقائي لأسباب الزيارات وإنشاء إحصائيات دقيقة',
                registerTab: 'تسجيل زائر جديد',
                visitorsTab: 'سجل الزوار والإحصائيات',
                aiInsightsTab: 'رؤى الذكاء الاصطناعي',
                fullNameLabel: 'الاسم الكامل',
                phoneLabel: 'رقم الهاتف',
                idTypeLabel: 'نوع الهوية',
                idNumberLabel: 'رقم الهوية',
                companyLabel: 'الشركة/المؤسسة',
                positionLabel: 'المنصب',
                visitReasonLabel: 'سبب الزيارة',
                employeeOfficeLabel: 'الموظف/المكتب المُراد زيارته',
                emailLabel: 'البريد الإلكتروني',
                nationalityLabel: 'الجنسية',
                notesLabel: 'ملاحظات إضافية',
                aiAnalysisTitle: 'تحليل الذكاء الاصطناعي للزائر',
                aiAnalysisLoadingText: 'جاري تحليل معلومات الزائر...',
                submitBtn: 'تسجيل الزائر',
                analyzeBtn: 'تحليل بالذكاء الاصطناعي',
                clearBtn: 'مسح البيانات',
                totalLabel: 'إجمالي الزوار',
                activeLabel: 'زوار نشطون',
                todayLabel: 'زوار اليوم',
                checkedOutLabel: 'تمت زيارتهم',
                weekLabel: 'زوار هذا الأسبوع',
                aiInsightsLabel: 'رؤى الذكاء الاصطناعي',
                naturalSearchTitle: 'البحث بالذكاء الاصطناعي',
                naturalSearchBtn: 'بحث ذكي',
                filterTitle: 'تصفية النتائج',
                dateFromLabel: 'من تاريخ',
                dateToLabel: 'إلى تاريخ',
                statusFilterLabel: 'حالة الزيارة',
                searchTitle: 'البحث المتقدم',
                searchNameLabel: 'البحث بالاسم',
                searchPhoneLabel: 'البحث برقم الهاتف',
                searchCompanyLabel: 'البحث بالشركة',
                searchEmployeeLabel: 'البحث بالموظف/المكتب',
                searchReasonLabel: 'البحث بسبب الزيارة',
                searchBtn: 'بحث',
                clearSearchBtn: 'مسح البحث',
                exportBtn: 'تصدير PDF',
                aiReportBtn: 'تقرير ذكي',
                exportCSVBtn: 'تصدير CSV',
                clearAllBtn: 'مسح جميع البيانات',
                showActiveBtn: 'عرض الزوار النشطون',
                showTodayBtn: 'زوار اليوم',
                showAllBtn: 'جميع الزوار',
                aiInsightsPageTitle: 'رؤى وتحليلات الذكاء الاصطناعي',
                aiInsightsPageDesc: 'استكشف الرؤى المدعومة بالذكاء الاصطناعي حول بيانات الزوار',
                generateInsightsBtn: 'إنشاء رؤى ذكية',
                weeklyReportBtn: 'تقرير أسبوعي ذكي',
                trendAnalysisBtn: 'تحليل الاتجاهات',
                aiEmptyTitle: 'لا توجد رؤى حالياً',
                aiEmptyMessage: 'انقر على أحد الأزرار أعلاه لإنشاء رؤى ذكية',
                loadingText: 'جاري تحميل البيانات...',
                emptyTitle: 'لا توجد سجلات',
                emptyMessage: 'لم يتم العثور على أي زوار مسجلين',
                modalTitle: 'تأكيد الحذف',
                modalMessage: 'هل أنت متأكد من أنك تريد حذف هذا السجل؟',
                aiReportModalTitle: 'التقرير الذكي',
                downloadReportBtn: 'تحميل التقرير',
                closeReportBtn: 'إغلاق',
                confirmDeleteBtn: 'نعم، احذف',
                cancelBtn: 'إلغاء',
                successMessage: 'تم تسجيل الزائر بنجاح!',
                deleteSuccessMessage: 'تم حذف السجل بنجاح!',
                clearAllMessage: 'تم حذف جميع السجلات بنجاح!',
                checkoutSuccessMessage: 'تم تسجيل انهاء الزيارة بنجاح!',
                clearAllConfirm: 'هل أنت متأكد من أنك تريد حذف جميع سجلات الزوار؟ هذا الإجراء لا يمكن التراجع عنه!',
                langText: 'English',
                checkoutBtn: 'إنهاء الزيارة',
                deleteBtn: 'حذف',
                statusActive: 'نشط',
                statusCheckedOut: 'تمت الزيارة',
                visitDate: 'تاريخ الزيارة',
                checkoutDate: 'تاريخ إنهاء الزيارة',
                employee: 'الموظف/المكتب',
                phone: 'الهاتف',
                company: 'الشركة',
                reason: 'سبب الزيارة',
                status: 'الحالة',
                actions: 'الإجراءات'
            },
            en: {
                headerTitle: 'AI-Powered Visitor Management System',
                headerSubtitle: 'MAIS Medical Products Company',
                aiBadge: 'AI-Powered',
                aiSectionTitle: 'Integrated AI Features',
                aiFeature1Title: 'Visitor Profile Analysis',
                aiFeature1Desc: 'Automatic analysis of visitor and company information for valuable insights',
                aiFeature2Title: 'AI-Powered Search',
                aiFeature2Desc: 'Natural language search for quick access to information',
                aiFeature3Title: 'Smart Reports',
                aiFeature3Desc: 'Generate detailed reports and analytical insights with AI',
                aiFeature4Title: 'Visit Classification',
                aiFeature4Desc: 'Automatic classification of visit reasons and accurate statistics',
                registerTab: 'Register New Visitor',
                visitorsTab: 'Visitors Log & Statistics',
                aiInsightsTab: 'AI Insights',
                fullNameLabel: 'Full Name',
                phoneLabel: 'Phone Number',
                idTypeLabel: 'ID Type',
                idNumberLabel: 'ID Number',
                companyLabel: 'Company/Organization',
                positionLabel: 'Position',
                visitReasonLabel: 'Visit Reason',
                employeeOfficeLabel: 'Employee/Office to Visit',
                emailLabel: 'Email Address',
                nationalityLabel: 'Nationality',
                notesLabel: 'Additional Notes',
                aiAnalysisTitle: 'AI Analysis of Visitor',
                aiAnalysisLoadingText: 'Analyzing visitor information...',
                submitBtn: 'Register Visitor',
                analyzeBtn: 'AI Analysis',
                clearBtn: 'Clear Data',
                totalLabel: 'Total Visitors',
                activeLabel: 'Active Visitors',
                todayLabel: 'Today\'s Visitors',
                checkedOutLabel: 'Checked Out',
                weekLabel: 'This Week\'s Visitors',
                aiInsightsLabel: 'AI Insights',
                naturalSearchTitle: 'AI-Powered Search',
                naturalSearchBtn: 'Smart Search',
                filterTitle: 'Filter Results',
                dateFromLabel: 'From Date',
                dateToLabel: 'To Date',
                statusFilterLabel: 'Visit Status',
                searchTitle: 'Advanced Search',
                searchNameLabel: 'Search by Name',
                searchPhoneLabel: 'Search by Phone',
                searchCompanyLabel: 'Search by Company',
                searchEmployeeLabel: 'Search by Employee/Office',
                searchReasonLabel: 'Search by Visit Reason',
                searchBtn: 'Search',
                clearSearchBtn: 'Clear Search',
                exportBtn: 'Export PDF',
                aiReportBtn: 'Smart Report',
                exportCSVBtn: 'Export CSV',
                clearAllBtn: 'Clear All Data',
                showActiveBtn: 'Show Active Visitors',
                showTodayBtn: 'Today\'s Visitors',
                showAllBtn: 'All Visitors',
                aiInsightsPageTitle: 'AI Insights & Analytics',
                aiInsightsPageDesc: 'Explore AI-powered insights about visitor data',
                generateInsightsBtn: 'Generate Smart Insights',
                weeklyReportBtn: 'Smart Weekly Report',
                trendAnalysisBtn: 'Trend Analysis',
                aiEmptyTitle: 'No Insights Available',
                aiEmptyMessage: 'Click one of the buttons above to generate smart insights',
                loadingText: 'Loading data...',
                emptyTitle: 'No Records Found',
                emptyMessage: 'No registered visitors found',
                modalTitle: 'Confirm Delete',
                modalMessage: 'Are you sure you want to delete this record?',
                aiReportModalTitle: 'Smart Report',
                downloadReportBtn: 'Download Report',
                closeReportBtn: 'Close',
                confirmDeleteBtn: 'Yes, Delete',
                cancelBtn: 'Cancel',
                successMessage: 'Visitor registered successfully!',
                deleteSuccessMessage: 'Record deleted successfully!',
                clearAllMessage: 'All records deleted successfully!',
                checkoutSuccessMessage: 'Visit checkout recorded successfully!',
                clearAllConfirm: 'Are you sure you want to delete all visitor records? This action cannot be undone!',
                langText: 'العربية',
                checkoutBtn: 'Check Out',
                deleteBtn: 'Delete',
                statusActive: 'Active',
                statusCheckedOut: 'Checked Out',
                visitDate: 'Visit Date',
                checkoutDate: 'Checkout Date',
                employee: 'Employee/Office',
                phone: 'Phone',
                company: 'Company',
                reason: 'Visit Reason',
                status: 'Status',
                actions: 'Actions'
            }
        };

        // وظائف الذكاء الاصطناعي
        async function callGeminiAPI(prompt, maxTokens = 1000) {
            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            maxOutputTokens: maxTokens,
                            temperature: 0.7,
                        }
                    })
                });

                const data = await response.json();
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error('No response from AI');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                return currentLanguage === 'ar' ? 
                    'عذراً، حدث خطأ في الاتصال بخدمة الذكاء الاصطناعي.' : 
                    'Sorry, there was an error connecting to the AI service.';
            }
        }

        // تحليل الزائر بالذكاء الاصطناعي
        async function analyzeVisitor() {
            const fullName = document.getElementById('fullName').value;
            const company = document.getElementById('company').value;
            const visitReason = document.getElementById('visitReason').value;
            const notes = document.getElementById('notes').value;
            const employeeOffice = document.getElementById('employeeOffice').value;

            if (!fullName && !company) {
                showNotification(
                    currentLanguage === 'ar' ? 
                    'يرجى إدخال اسم الزائر والشركة على الأقل' : 
                    'Please enter at least visitor name and company', 
                    'warning'
                );
                return;
            }

            const analysisSection = document.getElementById('aiAnalysisSection');
            const loadingDiv = document.getElementById('aiAnalysisLoading');
            const contentDiv = document.getElementById('aiAnalysisContent');

            analysisSection.style.display = 'block';
            loadingDiv.style.display = 'flex';
            contentDiv.innerHTML = '<div class="loading-ai" id="aiAnalysisLoading"><span>' + 
                translations[currentLanguage].aiAnalysisLoadingText + '</span></div>';

            const prompt = currentLanguage === 'ar' ? `
تحليل معلومات الزائر التالية وتقديم رؤى مفيدة:

الاسم: ${fullName}
الشركة: ${company}
سبب الزيارة: ${getReasonText(visitReason)}
الموظف/المكتب المراد زيارته: ${employeeOffice}
ملاحظات: ${notes}

يرجى تقديم تحليل شامل يتضمن:
1. معلومات مختصرة عن الشركة ونشاطها
2. تقييم طبيعة الزيارة ومستوى الأهمية
3. اقتراحات للاستعداد للزيارة
4. توصيات للمتابعة

اجعل التحليل مهنياً ومفيداً لموظف الاستقبال.
` : `
Analyze the following visitor information and provide useful insights:

Name: ${fullName}
Company: ${company}
Visit Reason: ${getReasonText(visitReason)}
Employee/Office to Visit: ${employeeOffice}
Notes: ${notes}

Please provide a comprehensive analysis including:
1. Brief information about the company and its activities
2. Assessment of the visit nature and importance level
3. Suggestions for visit preparation
4. Follow-up recommendations

Make the analysis professional and useful for reception staff.
`;

            try {
                const analysis = await callGeminiAPI(prompt, 1500);
                contentDiv.innerHTML = `<div class="ai-analysis-content">${analysis}</div>`;
                loadingDiv.style.display = 'none';
            } catch (error) {
                contentDiv.innerHTML = `<div class="ai-analysis-content">${
                    currentLanguage === 'ar' ? 
                    'عذراً، لم نتمكن من إنشاء التحليل في الوقت الحالي.' : 
                    'Sorry, we could not generate the analysis at this time.'
                }</div>`;
                loadingDiv.style.display = 'none';
            }
        }

        // البحث الطبيعي بالذكاء الاصطناعي
        async function performNaturalSearch() {
            const query = document.getElementById('naturalSearchInput').value.trim();
            if (!query) {
                showNotification(
                    currentLanguage === 'ar' ? 
                    'يرجى إدخال استعلام البحث' : 
                    'Please enter a search query', 
                    'warning'
                );
                return;
            }

            showNotification(
                currentLanguage === 'ar' ? 
                'جاري معالجة البحث الذكي...' : 
                'Processing smart search...', 
                'success'
            );

            // إنشاء ملخص البيانات للذكاء الاصطناعي
            const dataSummary = visitors.map(v => ({
                name: v.fullName,
                company: v.company,
                reason: v.visitReason,
                date: new Date(v.visitDate).toLocaleDateString(),
                status: v.status,
                employee: v.employeeOffice
            }));

            const prompt = currentLanguage === 'ar' ? `
المطلوب تحليل الاستعلام التالي وتحديد الزوار المطابقين من البيانات المتوفرة:

الاستعلام: "${query}"

البيانات المتوفرة:
${JSON.stringify(dataSummary, null, 2)}

يرجى تحديد الزوار المطابقين للاستعلام وإرجاع قائمة بأسمائهم أو "لا توجد نتائج" إذا لم تجد مطابقات.
أرجع الإجابة بصيغة قائمة أسماء فقط، مفصولة بفواصل.
` : `
Please analyze the following query and identify matching visitors from the available data:

Query: "${query}"

Available data:
${JSON.stringify(dataSummary, null, 2)}

Please identify visitors matching the query and return a list of their names or "No results" if no matches found.
Return the answer as a comma-separated list of names only.
`;

            try {
                const result = await callGeminiAPI(prompt, 800);
                
                // معالجة النتيجة وتصفية الزوار
                if (result.toLowerCase().includes('no results') || result.toLowerCase().includes('لا توجد')) {
                    filteredVisitors = [];
                } else {
                    const matchedNames = result.split(',').map(name => name.trim().toLowerCase());
                    filteredVisitors = visitors.filter(visitor => 
                        matchedNames.some(name => visitor.fullName.toLowerCase().includes(name))
                    );
                }

                currentFilter = 'ai-search';
                loadVisitors();
                
                showNotification(
                    currentLanguage === 'ar' ? 
                    `تم العثور على ${filteredVisitors.length} نتيجة` : 
                    `Found ${filteredVisitors.length} results`, 
                    'success'
                );
            } catch (error) {
                showNotification(
                    currentLanguage === 'ar' ? 
                    'عذراً، حدث خطأ في البحث الذكي' : 
                    'Sorry, error in smart search', 
                    'error'
                );
            }
        }

        // تعيين استعلام البحث الطبيعي
        function setNaturalSearch(query) {
            document.getElementById('naturalSearchInput').value = query;
        }

        // إنشاء تقرير ذكي
        async function generateAIReport() {
            document.getElementById('aiReportModal').style.display = 'block';
            document.getElementById('aiReportContent').innerHTML = `
                <div class="loading-ai">
                    <span>${currentLanguage === 'ar' ? 'جاري إنشاء التقرير الذكي...' : 'Generating smart report...'}</span>
                </div>
            `;

            const today = new Date();
            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);

            const totalVisitors = visitors.length;
            const activeVisitors = visitors.filter(v => v.status === 'active').length;
            const todayVisitors = visitors.filter(v => 
                new Date(v.visitDate).toDateString() === today.toDateString()
            ).length;
            const weekVisitors = visitors.filter(v => 
                new Date(v.visitDate) >= weekAgo
            ).length;

            const companiesData = {};
            const reasonsData = {};

            visitors.forEach(visitor => {
                companiesData[visitor.company] = (companiesData[visitor.company] || 0) + 1;
                reasonsData[visitor.visitReason] = (reasonsData[visitor.visitReason] || 0) + 1;
            });

            const topCompanies = Object.entries(companiesData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const topReasons = Object.entries(reasonsData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const prompt = currentLanguage === 'ar' ? `
إنشاء تقرير تحليلي شامل لبيانات زوار شركة MAIS للمنتجات الطبية:

الإحصائيات العامة:
- إجمالي الزوار: ${totalVisitors}
- الزوار النشطون حالياً: ${activeVisitors}
- زوار اليوم: ${todayVisitors}
- زوار هذا الأسبوع: ${weekVisitors}

أهم الشركات الزائرة:
${topCompanies.map(([company, count]) => `- ${company}: ${count} زيارة`).join('\n')}

أهم أسباب الزيارات:
${topReasons.map(([reason, count]) => `- ${getReasonText(reason)}: ${count} زيارة`).join('\n')}

يرجى إنشاء تقرير تحليلي مفصل يتضمن:
1. ملخص تنفيذي
2. تحليل الاتجاهات
3. الرؤى والتوصيات
4. النقاط المهمة للإدارة

اجعل التقرير مهنياً ومناسباً للإدارة العليا.
` : `
Generate a comprehensive analytical report for MAIS Medical Products Company visitor data:

General Statistics:
- Total Visitors: ${totalVisitors}
- Currently Active Visitors: ${activeVisitors}
- Today's Visitors: ${todayVisitors}
- This Week's Visitors: ${weekVisitors}

Top Visiting Companies:
${topCompanies.map(([company, count]) => `- ${company}: ${count} visits`).join('\n')}

Top Visit Reasons:
${topReasons.map(([reason, count]) => `- ${getReasonText(reason)}: ${count} visits`).join('\n')}

Please generate a detailed analytical report including:
1. Executive Summary
2. Trend Analysis
3. Insights and Recommendations
4. Key Points for Management

Make the report professional and suitable for senior management.
`;

            try {
                const report = await callGeminiAPI(prompt, 2000);
                aiReportContent = report;
                document.getElementById('aiReportContent').innerHTML = `
                    <div class="ai-report-content">${report}</div>
                `;
                document.getElementById('downloadReportBtn').style.display = 'inline-flex';
            } catch (error) {
                document.getElementById('aiReportContent').innerHTML = `
                    <div class="ai-report-content">${
                        currentLanguage === 'ar' ? 
                        'عذراً، لم نتمكن من إنشاء التقرير في الوقت الحالي.' : 
                        'Sorry, we could not generate the report at this time.'
                    }</div>
                `;
            }
        }

        // إنشاء رؤى ذكية
        async function generateAIInsights() {
            const contentDiv = document.getElementById('aiInsightsContent');
            contentDiv.innerHTML = `
                <div class="loading-ai">
                    <span>${currentLanguage === 'ar' ? 'جاري إنشاء الرؤى الذكية...' : 'Generating smart insights...'}</span>
                </div>
            `;

            const visitorsThisMonth = visitors.filter(v => {
                const visitDate = new Date(v.visitDate);
                const now = new Date();
                return visitDate.getMonth() === now.getMonth() && visitDate.getFullYear() === now.getFullYear();
            });

            const prompt = currentLanguage === 'ar' ? `
تحليل بيانات الزوار لشركة MAIS وتقديم رؤى ذكية:

بيانات هذا الشهر: ${visitorsThisMonth.length} زائر
إجمالي الزوار: ${visitors.length}
الزوار النشطون: ${visitors.filter(v => v.status === 'active').length}

أنواع الزيارات:
${Object.entries(visitors.reduce((acc, v) => {
    acc[v.visitReason] = (acc[v.visitReason] || 0) + 1;
    return acc;
}, {})).map(([reason, count]) => `${getReasonText(reason)}: ${count}`).join(', ')}

قدم رؤى ذكية تتضمن:
1. تحليل الأنماط الزمنية
2. تحديد الاتجاهات المهمة
3. اقتراحات التحسين
4. توقعات مستقبلية
5. نصائح إدارية

اجعل الرؤى عملية ومفيدة لتحسين إدارة الزوار.
` : `
Analyze visitor data for MAIS company and provide smart insights:

This month's data: ${visitorsThisMonth.length} visitors
Total visitors: ${visitors.length}
Active visitors: ${visitors.filter(v => v.status === 'active').length}

Visit types:
${Object.entries(visitors.reduce((acc, v) => {
    acc[v.visitReason] = (acc[v.visitReason] || 0) + 1;
    return acc;
}, {})).map(([reason, count]) => `${getReasonText(reason)}: ${count}`).join(', ')}

Provide smart insights including:
1. Time pattern analysis
2. Important trend identification
3. Improvement suggestions
4. Future predictions
5. Management tips

Make insights practical and useful for improving visitor management.
`;

            try {
                const insights = await callGeminiAPI(prompt, 1800);
                contentDiv.innerHTML = `
                    <div class="ai-report-content">${insights}</div>
                `;
                
                // تحديث عداد الرؤى
                document.getElementById('aiInsightsCount').textContent = '✓';
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>${currentLanguage === 'ar' ? 'خطأ في إنشاء الرؤى' : 'Error generating insights'}</h3>
                        <p>${currentLanguage === 'ar' ? 'يرجى المحاولة مرة أخرى' : 'Please try again'}</p>
                    </div>
                `;
            }
        }

        // إنشاء تقرير أسبوعي ذكي
        async function generateWeeklyReport() {
            const contentDiv = document.getElementById('aiInsightsContent');
            contentDiv.innerHTML = `
                <div class="loading-ai">
                    <span>${currentLanguage === 'ar' ? 'جاري إنشاء التقرير الأسبوعي...' : 'Generating weekly report...'}</span>
                </div>
            `;

            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            
            const weeklyVisitors = visitors.filter(v => new Date(v.visitDate) >= weekAgo);
            
            const dailyBreakdown = {};
            weeklyVisitors.forEach(visitor => {
                const day = new Date(visitor.visitDate).toLocaleDateString();
                dailyBreakdown[day] = (dailyBreakdown[day] || 0) + 1;
            });

            const prompt = currentLanguage === 'ar' ? `
إنشاء تقرير أسبوعي شامل لزوار شركة MAIS:

فترة التقرير: آخر 7 أيام
عدد الزوار: ${weeklyVisitors.length}

التوزيع اليومي:
${Object.entries(dailyBreakdown).map(([date, count]) => `${date}: ${count} زائر`).join('\n')}

أهم الشركات الزائرة هذا الأسبوع:
${Object.entries(weeklyVisitors.reduce((acc, v) => {
    acc[v.company] = (acc[v.company] || 0) + 1;
    return acc;
}, {})).slice(0, 5).map(([company, count]) => `${company}: ${count} زيارة`).join('\n')}

قدم تقريراً أسبوعياً يتضمن:
1. ملخص الأسبوع
2. مقارنة مع الأسابيع السابقة (إذا كانت البيانات متوفرة)
3. أبرز الأحداث والزيارات
4. التوصيات للأسبوع القادم
5. نقاط تحتاج متابعة

اجعل التقرير مفيداً لفريق الإدارة.
` : `
Generate a comprehensive weekly report for MAIS company visitors:

Report Period: Last 7 days
Number of visitors: ${weeklyVisitors.length}

Daily Breakdown:
${Object.entries(dailyBreakdown).map(([date, count]) => `${date}: ${count} visitors`).join('\n')}

Top visiting companies this week:
${Object.entries(weeklyVisitors.reduce((acc, v) => {
    acc[v.company] = (acc[v.company] || 0) + 1;
    return acc;
}, {})).slice(0, 5).map(([company, count]) => `${company}: ${count} visits`).join('\n')}

Provide a weekly report including:
1. Week summary
2. Comparison with previous weeks (if data available)
3. Key events and visits
4. Recommendations for next week
5. Points requiring follow-up

Make the report useful for the management team.
`;

            try {
                const report = await callGeminiAPI(prompt, 1800);
                contentDiv.innerHTML = `
                    <div class="ai-report-content">${report}</div>
                `;
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>${currentLanguage === 'ar' ? 'خطأ في إنشاء التقرير' : 'Error generating report'}</h3>
                        <p>${currentLanguage === 'ar' ? 'يرجى المحاولة مرة أخرى' : 'Please try again'}</p>
                    </div>
                `;
            }
        }

        // تحليل الاتجاهات
        async function generateTrendAnalysis() {
            const contentDiv = document.getElementById('aiInsightsContent');
            contentDiv.innerHTML = `
                <div class="loading-ai">
                    <span>${currentLanguage === 'ar' ? 'جاري تحليل الاتجاهات...' : 'Analyzing trends...'}</span>
                </div>
            `;

            // تحليل البيانات حسب الشهر
            const monthlyData = {};
            visitors.forEach(visitor => {
                const month = new Date(visitor.visitDate).toISOString().slice(0, 7);
                if (!monthlyData[month]) {
                    monthlyData[month] = { total: 0, reasons: {}, companies: {} };
                }
                monthlyData[month].total++;
                monthlyData[month].reasons[visitor.visitReason] = (monthlyData[month].reasons[visitor.visitReason] || 0) + 1;
                monthlyData[month].companies[visitor.company] = (monthlyData[month].companies[visitor.company] || 0) + 1;
            });

            const prompt = currentLanguage === 'ar' ? `
تحليل اتجاهات زوار شركة MAIS بناءً على البيانات التالية:

البيانات الشهرية:
${Object.entries(monthlyData).map(([month, data]) => 
    `${month}: ${data.total} زائر`
).join('\n')}

قدم تحليلاً شاملاً للاتجاهات يتضمن:
1. الاتجاهات الزمنية العامة
2. أنماط الزيارات الموسمية
3. نمو أو تراجع أعداد الزوار
4. تغييرات في أنواع الزيارات
5. توقعات الاتجاهات المستقبلية
6. عوامل قد تؤثر على هذه الاتجاهات
7. استراتيجيات للاستفادة من الاتجاهات الإيجابية

اجعل التحليل مفيداً لاتخاذ القرارات الاستراتيجية.
` : `
Analyze visitor trends for MAIS company based on the following data:

Monthly Data:
${Object.entries(monthlyData).map(([month, data]) => 
    `${month}: ${data.total} visitors`
).join('\n')}

Provide comprehensive trend analysis including:
1. General time trends
2. Seasonal visit patterns
3. Growth or decline in visitor numbers
4. Changes in visit types
5. Future trend predictions
6. Factors that may affect these trends
7. Strategies to leverage positive trends

Make the analysis useful for strategic decision-making.
`;

            try {
                const analysis = await callGeminiAPI(prompt, 2000);
                contentDiv.innerHTML = `
                    <div class="ai-report-content">${analysis}</div>
                `;
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>${currentLanguage === 'ar' ? 'خطأ في تحليل الاتجاهات' : 'Error analyzing trends'}</h3>
                        <p>${currentLanguage === 'ar' ? 'يرجى المحاولة مرة أخرى' : 'Please try again'}</p>
                    </div>
                `;
            }
        }

        // تحميل التقرير الذكي
        function downloadAIReport() {
            if (!aiReportContent) return;

            const blob = new Blob([aiReportContent], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `AI_Report_${new Date().toISOString().slice(0, 10)}.txt`;
            link.click();
        }

        // إغلاق نافذة التقرير الذكي
        function closeAIReportModal() {
            document.getElementById('aiReportModal').style.display = 'none';
            document.getElementById('downloadReportBtn').style.display = 'none';
            aiReportContent = '';
        }

        // تحديث النصوص
        function updateTexts() {
            const texts = translations[currentLanguage];
            for (const [key, value] of Object.entries(texts)) {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = value;
                }
            }
            
            // تحديث الاتجاه
            const container = document.getElementById('container');
            if (currentLanguage === 'ar') {
                container.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('lang', 'ar');
            } else {
                container.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('lang', 'en');
            }
            
            // تحديث قوائم الاختيار
            updateSelectOptions();
            
            // تحديث placeholders
            updatePlaceholders();
        }

        // تحديث النصوص النائبة
        function updatePlaceholders() {
            const placeholders = {
                ar: {
                    fullName: 'ادخل الاسم الكامل',
                    phone: 'ادخل رقم الهاتف',
                    idNumber: 'ادخل رقم الهوية',
                    company: 'ادخل اسم الشركة',
                    position: 'ادخل المنصب',
                    employeeOffice: 'ادخل اسم الموظف أو المكتب',
                    email: 'ادخل البريد الإلكتروني',
                    nationality: 'ادخل الجنسية',
                    notes: 'أضف أي ملاحظات إضافية هنا...',
                    naturalSearchInput: 'اسأل عن الزوار، مثال: أظهر لي زوار شركة X الأسبوع الماضي',
                    searchName: 'ادخل الاسم...',
                    searchPhone: 'ادخل رقم الهاتف...',
                    searchCompany: 'ادخل اسم الشركة...',
                    searchEmployee: 'ادخل اسم الموظف...'
                },
                en: {
                    fullName: 'Enter full name',
                    phone: 'Enter phone number',
                    idNumber: 'Enter ID number',
                    company: 'Enter company name',
                    position: 'Enter position',
                    employeeOffice: 'Enter employee or office name',
                    email: 'Enter email address',
                    nationality: 'Enter nationality',
                    notes: 'Add any additional notes here...',
                    naturalSearchInput: 'Ask about visitors, e.g.: Show me visitors from company X last week',
                    searchName: 'Enter name...',
                    searchPhone: 'Enter phone number...',
                    searchCompany: 'Enter company name...',
                    searchEmployee: 'Enter employee name...'
                }
            };

            const currentPlaceholders = placeholders[currentLanguage];
            for (const [id, placeholder] of Object.entries(currentPlaceholders)) {
                const element = document.getElementById(id);
                if (element) {
                    element.placeholder = placeholder;
                }
            }
        }

        // تحديث خيارات قوائم الاختيار
        function updateSelectOptions() {
            const idTypeSelect = document.getElementById('idType');
            const visitReasonSelect = document.getElementById('visitReason');
            const searchReasonSelect = document.getElementById('searchReason');
            const statusFilterSelect = document.getElementById('statusFilter');

            if (currentLanguage === 'ar') {
                idTypeSelect.innerHTML = `
                    <option value="">اختر نوع الهوية</option>
                    <option value="national">هوية وطنية</option>
                    <option value="passport">جواز سفر</option>
                    <option value="residence">إقامة</option>
                    <option value="other">أخرى</option>
                `;
                
                visitReasonSelect.innerHTML = `
                    <option value="">اختر سبب الزيارة</option>
                    <option value="business">اجتماع عمل</option>
                    <option value="consultation">استشارة طبية</option>
                    <option value="meeting">اجتماع</option>
                    <option value="delivery">تسليم</option>
                    <option value="maintenance">صيانة</option>
                    <option value="training">تدريب</option>
                    <option value="interview">مقابلة</option>
                    <option value="other">أخرى</option>
                `;
                
                searchReasonSelect.innerHTML = `
                    <option value="">جميع الأسباب</option>
                    <option value="business">اجتماع عمل</option>
                    <option value="consultation">استشارة طبية</option>
                    <option value="meeting">اجتماع</option>
                    <option value="delivery">تسليم</option>
                    <option value="maintenance">صيانة</option>
                    <option value="training">تدريب</option>
                    <option value="interview">مقابلة</option>
                    <option value="other">أخرى</option>
                `;

                statusFilterSelect.innerHTML = `
                    <option value="">جميع الحالات</option>
                    <option value="active">نشط</option>
                    <option value="checked-out">تمت الزيارة</option>
                `;
            } else {
                idTypeSelect.innerHTML = `
                    <option value="">Select ID Type</option>
                    <option value="national">National ID</option>
                    <option value="passport">Passport</option>
                    <option value="residence">Residence Permit</option>
                    <option value="other">Other</option>
                `;
                
                visitReasonSelect.innerHTML = `
                    <option value="">Select Visit Reason</option>
                    <option value="business">Business Meeting</option>
                    <option value="consultation">Medical Consultation</option>
                    <option value="meeting">Meeting</option>
                    <option value="delivery">Delivery</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="training">Training</option>
                    <option value="interview">Interview</option>
                    <option value="other">Other</option>
                `;
                
                searchReasonSelect.innerHTML = `
                    <option value="">All Reasons</option>
                    <option value="business">Business Meeting</option>
                    <option value="consultation">Medical Consultation</option>
                    <option value="meeting">Meeting</option>
                    <option value="delivery">Delivery</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="training">Training</option>
                    <option value="interview">Interview</option>
                    <option value="other">Other</option>
                `;

                statusFilterSelect.innerHTML = `
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="checked-out">Checked Out</option>
                `;
            }
        }

        // تبديل اللغة
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            updateTexts();
            loadVisitors();
            updateStats();
        }

        // إظهار التبويب
        function showTab(tabName) {
            // إخفاء جميع التبويبات
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // إزالة الكلاس النشط من جميع الأزرار
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // إظهار التبويب المحدد
            document.getElementById(tabName).classList.add('active');
            
            // إضافة الكلاس النشط للزر المحدد
            if (tabName === 'register') {
                document.getElementById('registerTab').classList.add('active');
            } else if (tabName === 'visitors') {
                document.getElementById('visitorsTab').classList.add('active');
                loadVisitors();
                updateStats();
            } else if (tabName === 'aiInsights') {
                document.getElementById('aiInsightsTab').classList.add('active');
            }
        }

        // إرسال النموذج
        document.getElementById('visitorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const visitor = {
                id: Date.now(),
                fullName: formData.get('fullName') || '-',
                phone: formData.get('phone') || '-',
                idType: formData.get('idType') || '-',
                idNumber: formData.get('idNumber') || '-',
                company: formData.get('company') || '-',
                position: formData.get('position') || '-',
                visitReason: formData.get('visitReason') || '-',
                employeeOffice: formData.get('employeeOffice') || '-',
                email: formData.get('email') || '-',
                nationality: formData.get('nationality') || '-',
                notes: formData.get('notes') || '-',
                visitDate: new Date().toISOString(),
                status: 'active',
                checkoutDate: null
            };
            
            visitors.push(visitor);
            localStorage.setItem('visitors', JSON.stringify(visitors));
            
            showNotification(translations[currentLanguage].successMessage, 'success');
            clearForm();
            
            // التبديل تلقائياً إلى تبويب الزوار وتحديث الإحصائيات
            showTab('visitors');
            setTimeout(() => {
                updateStats();
            }, 100);
        });

        // مسح النموذج
        function clearForm() {
            document.getElementById('visitorForm').reset();
            document.getElementById('aiAnalysisSection').style.display = 'none';
        }

        // إظهار الإشعارات
        function showNotification(message, type = 'success') {
            // إزالة الإشعارات السابقة
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // تحديث الإحصائيات
        function updateStats() {
            const total = visitors.length;
            const active = visitors.filter(v => v.status === 'active').length;
            const checkedOut = visitors.filter(v => v.status === 'checked-out').length;
            
            const today = new Date().toDateString();
            const todayCount = visitors.filter(v => 
                new Date(v.visitDate).toDateString() === today
            ).length;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekCount = visitors.filter(v => 
                new Date(v.visitDate) >= weekAgo
            ).length;
            
            document.getElementById('totalVisitors').textContent = total;
            document.getElementById('activeVisitors').textContent = active;
            document.getElementById('todayVisitors').textContent = todayCount;
            document.getElementById('checkedOutVisitors').textContent = checkedOut;
            document.getElementById('weekVisitors').textContent = weekCount;
        }

        // تحميل الزوار
        function loadVisitors() {
            const loadingDiv = document.getElementById('loadingIndicator');
            const emptyDiv = document.getElementById('emptyState');
            const displayDiv = document.getElementById('visitorsDisplay');
            
            loadingDiv.style.display = 'block';
            emptyDiv.style.display = 'none';
            displayDiv.innerHTML = '';
            
            setTimeout(() => {
                loadingDiv.style.display = 'none';
                
                if (filteredVisitors.length === 0) {
                    emptyDiv.style.display = 'block';
                } else {
                    emptyDiv.style.display = 'none';
                    renderVisitors();
                }
            }, 500);
        }

        // عرض الزوار كبطاقات
        function renderVisitors() {
            const displayDiv = document.getElementById('visitorsDisplay');
            displayDiv.innerHTML = '';
            
            filteredVisitors.forEach((visitor, index) => {
                const card = document.createElement('div');
                card.className = 'visitor-card';
                
                const visitDate = new Date(visitor.visitDate);
                const formattedVisitDate = visitDate.toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US') + 
                                         ' ' + visitDate.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                
                let checkoutInfo = '';
                if (visitor.checkoutDate) {
                    const checkoutDate = new Date(visitor.checkoutDate);
                    const formattedCheckoutDate = checkoutDate.toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US') + 
                                                 ' ' + checkoutDate.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                    checkoutInfo = `
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].checkoutDate}:</strong> ${formattedCheckoutDate}
                        </div>
                    `;
                }
                
                const idTypeText = getIdTypeText(visitor.idType);
                const reasonText = getReasonText(visitor.visitReason);
                const statusText = visitor.status === 'active' ? 
                    translations[currentLanguage].statusActive : 
                    translations[currentLanguage].statusCheckedOut;
                
                card.innerHTML = `
                    <h4>${visitor.fullName}</h4>
                    <div class="visitor-details">
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].phone}:</strong> ${visitor.phone}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].company}:</strong> ${visitor.company}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].employee}:</strong> ${visitor.employeeOffice}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].reason}:</strong> ${reasonText}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].visitDate}:</strong> ${formattedVisitDate}
                        </div>
                        ${checkoutInfo}
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].status}:</strong> 
                            <span class="status-badge ${visitor.status === 'active' ? 'status-active' : 'status-checked-out'}">${statusText}</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        ${visitor.status === 'active' ? `
                            <button class="action-btn checkout-btn" onclick="checkoutVisitor(${visitors.indexOf(visitor)})">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                                ${translations[currentLanguage].checkoutBtn}
                            </button>
                        ` : ''}
                        <button class="action-btn delete-btn" onclick="confirmDelete(${visitors.indexOf(visitor)})">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                            </svg>
                            ${translations[currentLanguage].deleteBtn}
                        </button>
                    </div>
                `;
                
                displayDiv.appendChild(card);
            });
        }

        // إنهاء زيارة
        function checkoutVisitor(index) {
            visitors[index].status = 'checked-out';
            visitors[index].checkoutDate = new Date().toISOString();
            localStorage.setItem('visitors', JSON.stringify(visitors));
            
            showNotification(translations[currentLanguage].checkoutSuccessMessage, 'success');
            applyCurrentFilter();
            updateStats();
        }

        // عرض الزوار النشطون
        function showActiveVisitors() {
            currentFilter = 'active';
            filteredVisitors = visitors.filter(v => v.status === 'active');
            loadVisitors();
        }

        // عرض زوار اليوم
        function showTodayVisitors() {
            currentFilter = 'today';
            const today = new Date().toDateString();
            filteredVisitors = visitors.filter(v => 
                new Date(v.visitDate).toDateString() === today
            );
            loadVisitors();
        }

        // عرض جميع الزوار
        function showAllVisitors() {
            currentFilter = 'all';
            filteredVisitors = [...visitors];
            loadVisitors();
        }

        // تطبيق الفلتر الحالي
        function applyCurrentFilter() {
            switch (currentFilter) {
                case 'active':
                    showActiveVisitors();
                    break;
                case 'today':
                    showTodayVisitors();
                    break;
                default:
                    showAllVisitors();
                    break;
            }
        }

        // الحصول على نص نوع الهوية
        function getIdTypeText(idType) {
            const texts = {
                ar: {
                    national: 'هوية وطنية',
                    passport: 'جواز سفر',
                    residence: 'إقامة',
                    other: 'أخرى'
                },
                en: {
                    national: 'National ID',
                    passport: 'Passport',
                    residence: 'Residence Permit',
                    other: 'Other'
                }
            };
            return texts[currentLanguage][idType] || idType;
        }

        // الحصول على نص سبب الزيارة
        function getReasonText(reason) {
            const texts = {
                ar: {
                    business: 'اجتماع عمل',
                    consultation: 'استشارة طبية',
                    meeting: 'اجتماع',
                    delivery: 'تسليم',
                    maintenance: 'صيانة',
                    training: 'تدريب',
                    interview: 'مقابلة',
                    other: 'أخرى'
                },
                en: {
                    business: 'Business Meeting',
                    consultation: 'Medical Consultation',
                    meeting: 'Meeting',
                    delivery: 'Delivery',
                    maintenance: 'Maintenance',
                    training: 'Training',
                    interview: 'Interview',
                    other: 'Other'
                }
            };
            return texts[currentLanguage][reason] || reason;
        }

        // تأكيد الحذف
        function confirmDelete(index) {
            deleteIndex = index;
            document.getElementById('confirmModal').style.display = 'block';
        }

        // تنفيذ الحذف
        function executeDelete() {
            if (deleteIndex >= 0) {
                visitors.splice(deleteIndex, 1);
                localStorage.setItem('visitors', JSON.stringify(visitors));
                
                showNotification(translations[currentLanguage].deleteSuccessMessage, 'success');
                applyCurrentFilter();
                updateStats();
            }
            closeModal();
        }

        // إغلاق النافذة المنبثقة
        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
            deleteIndex = -1;
        }

        // تأكيد مسح جميع البيانات
        function confirmClearAll() {
            const confirmed = confirm(translations[currentLanguage].clearAllConfirm);
            if (confirmed) {
                visitors = [];
                filteredVisitors = [];
                localStorage.setItem('visitors', JSON.stringify(visitors));
                
                showNotification(translations[currentLanguage].clearAllMessage, 'success');
                loadVisitors();
                updateStats();
            }
        }

        // البحث في الزوار
        function searchVisitors() {
            const name = document.getElementById('searchName').value.toLowerCase();
            const phone = document.getElementById('searchPhone').value.toLowerCase();
            const company = document.getElementById('searchCompany').value.toLowerCase();
            const employee = document.getElementById('searchEmployee').value.toLowerCase();
            const reason = document.getElementById('searchReason').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            filteredVisitors = visitors.filter(visitor => {
                const matchName = !name || visitor.fullName.toLowerCase().includes(name);
                const matchPhone = !phone || visitor.phone.toLowerCase().includes(phone);
                const matchCompany = !company || visitor.company.toLowerCase().includes(company);
                const matchEmployee = !employee || visitor.employeeOffice.toLowerCase().includes(employee);
                const matchReason = !reason || visitor.visitReason === reason;
                const matchStatus = !statusFilter || visitor.status === statusFilter;
                
                let matchDate = true;
                if (dateFrom || dateTo) {
                    const visitDate = new Date(visitor.visitDate).toDateString();
                    if (dateFrom) {
                        matchDate = matchDate && new Date(visitDate) >= new Date(dateFrom);
                    }
                    if (dateTo) {
                        matchDate = matchDate && new Date(visitDate) <= new Date(dateTo);
                    }
                }
                
                return matchName && matchPhone && matchCompany && matchEmployee && matchReason && matchStatus && matchDate;
            });
            
            currentFilter = 'search';
            loadVisitors();
        }

        // مسح البحث
        function clearSearch() {
            document.getElementById('searchName').value = '';
            document.getElementById('searchPhone').value = '';
            document.getElementById('searchCompany').value = '';
            document.getElementById('searchEmployee').value = '';
            document.getElementById('searchReason').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('naturalSearchInput').value = '';
            
            showAllVisitors();
        }

        // تصدير إلى PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont('helvetica');
            
            const title = currentLanguage === 'ar' ? 
                'تقرير سجل الزوار - شركة MAIS' : 
                'Visitors Log Report - MAIS Company';
            
            doc.setFontSize(16);
            doc.text(title, 20, 20);
            
            const date = new Date().toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
            doc.setFontSize(12);
            doc.text(`${currentLanguage === 'ar' ? 'تاريخ التقرير: ' : 'Report Date: '}${date}`, 20, 35);
            
            let yPos = 50;
            
            filteredVisitors.forEach((visitor, index) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                const visitDate = new Date(visitor.visitDate).toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                const idTypeText = getIdTypeText(visitor.idType);
                const reasonText = getReasonText(visitor.visitReason);
                const statusText = visitor.status === 'active' ? 
                    translations[currentLanguage].statusActive : 
                    translations[currentLanguage].statusCheckedOut;
                
                doc.text(`${index + 1}. ${visitor.fullName}`, 20, yPos);
                doc.text(`${currentLanguage === 'ar' ? 'الهاتف: ' : 'Phone: '}${visitor.phone}`, 20, yPos + 10);
                doc.text(`${currentLanguage === 'ar' ? 'الشركة: ' : 'Company: '}${visitor.company}`, 20, yPos + 20);
                doc.text(`${currentLanguage === 'ar' ? 'الموظف/المكتب: ' : 'Employee/Office: '}${visitor.employeeOffice}`, 20, yPos + 30);
                doc.text(`${currentLanguage === 'ar' ? 'سبب الزيارة: ' : 'Visit Reason: '}${reasonText}`, 20, yPos + 40);
                doc.text(`${currentLanguage === 'ar' ? 'الحالة: ' : 'Status: '}${statusText}`, 20, yPos + 50);
                doc.text(`${currentLanguage === 'ar' ? 'التاريخ: ' : 'Date: '}${visitDate}`, 20, yPos + 60);
                
                yPos += 75;
            });
            
            doc.save('visitors_report.pdf');
        }

        // تصدير إلى CSV
        function exportToCSV() {
            const csvContent = [
                [
                    currentLanguage === 'ar' ? 'الاسم' : 'Name',
                    currentLanguage === 'ar' ? 'الهاتف' : 'Phone',
                    currentLanguage === 'ar' ? 'الشركة' : 'Company',
                    currentLanguage === 'ar' ? 'الموظف/المكتب' : 'Employee/Office',
                    currentLanguage === 'ar' ? 'سبب الزيارة' : 'Visit Reason',
                    currentLanguage === 'ar' ? 'الحالة' : 'Status',
                    currentLanguage === 'ar' ? 'تاريخ الزيارة' : 'Visit Date',
                    currentLanguage === 'ar' ? 'تاريخ إنهاء الزيارة' : 'Checkout Date'
                ].join(',')
            ];

            filteredVisitors.forEach(visitor => {
                const visitDate = new Date(visitor.visitDate).toLocaleDateString();
                const checkoutDate = visitor.checkoutDate ? new Date(visitor.checkoutDate).toLocaleDateString() : '-';
                const reasonText = getReasonText(visitor.visitReason);
                const statusText = visitor.status === 'active' ? 
                    translations[currentLanguage].statusActive : 
                    translations[currentLanguage].statusCheckedOut;

                csvContent.push([
                    visitor.fullName,
                    visitor.phone,
                    visitor.company,
                    visitor.employeeOffice,
                    reasonText,
                    statusText,
                    visitDate,
                    checkoutDate
                ].join(','));
            });

            const blob = new Blob([csvContent.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'visitors_report.csv';
            link.click();
        }

        // إضافة مستمعي الأحداث للبحث والفلترة
        document.getElementById('searchName').addEventListener('input', searchVisitors);
        document.getElementById('searchPhone').addEventListener('input', searchVisitors);
        document.getElementById('searchCompany').addEventListener('input', searchVisitors);
        document.getElementById('searchEmployee').addEventListener('input', searchVisitors);
        document.getElementById('searchReason').addEventListener('change', searchVisitors);
        document.getElementById('dateFrom').addEventListener('change', searchVisitors);
        document.getElementById('dateTo').addEventListener('change', searchVisitors);
        document.getElementById('statusFilter').addEventListener('change', searchVisitors);

        // مستمع للبحث الطبيعي بـ Enter
        document.getElementById('naturalSearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performNaturalSearch();
            }
        });

        // إغلاق النافذة المنبثقة عند النقر خارجها
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            const aiModal = document.getElementById('aiReportModal');
            
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === aiModal) {
                closeAIReportModal();
            }
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            updateTexts();
            filteredVisitors = [...visitors];
            updateStats();
            
            // إخفاء قسم تحليل الذكاء الاصطناعي في البداية
            document.getElementById('aiAnalysisSection').style.display = 'none';
        });
    </script>
</body>
</html>