<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة تسجيل الزوار - MAIS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .language-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            padding: 30px;
        }

        .nav-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            transform: translateY(-3px);
        }

        .tab-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .tab-btn.active:hover {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2E8B57;
            background: white;
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
            transform: translateY(-2px);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .stat-card p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stat-card.active-visitors {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .stat-card.checked-out {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        }

        .search-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .visitors-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #e9ecef;
        }

        .table th {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-checked-out {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2E8B57;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            color: #dc3545;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .modal p {
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .visitor-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #2E8B57;
        }

        .visitor-card h4 {
            color: #2E8B57;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .visitor-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .visitor-detail {
            font-size: 0.9rem;
            color: #666;
        }

        .visitor-detail strong {
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkout-btn {
            background: #ffc107;
            color: #212529;
        }

        .checkout-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideInRight 0.5s ease;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }

        .notification.error {
            background: #dc3545;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .table {
                font-size: 0.9rem;
            }
            
            .table th,
            .table td {
                padding: 10px 8px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .table-responsive {
            overflow-x: auto;
        }

        /* English styles */
        .container[dir="ltr"] {
            direction: ltr;
        }

        .container[dir="ltr"] .table th,
        .container[dir="ltr"] .table td {
            text-align: left;
        }

        .container[dir="ltr"] .language-toggle {
            left: auto;
            right: 20px;
        }

        .container[dir="ltr"] .visitor-card {
            border-left: none;
            border-right: 5px solid #2E8B57;
        }

        .container[dir="ltr"] .notification {
            right: auto;
            left: 20px;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .container[dir="ltr"] .notification {
            animation: slideInLeft 0.5s ease;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-section {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .date-filter {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <header class="header">
            <button class="language-toggle" onclick="toggleLanguage()">
                <span id="langText">English</span>
            </button>
            <h1 id="headerTitle">نظام إدارة تسجيل الزوار</h1>
            <p id="headerSubtitle">شركة MAIS للمنتجات الطبية</p>
        </header>

        <main class="main-content">
            <nav class="nav-tabs">
                <button class="tab-btn active" onclick="showTab('register')" id="registerTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    تسجيل زائر جديد
                </button>
                <button class="tab-btn" onclick="showTab('visitors')" id="visitorsTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                    </svg>
                    سجل الزوار والإحصائيات
                </button>
            </nav>

            <div id="successMessage" class="success-message" style="display: none;"></div>

            <!-- تسجيل زائر جديد -->
            <div id="register" class="tab-content active">
                <form id="visitorForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fullName" id="fullNameLabel">الاسم الكامل</label>
                            <input type="text" id="fullName" name="fullName" placeholder="ادخل الاسم الكامل">
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" id="phoneLabel">رقم الهاتف</label>
                            <input type="tel" id="phone" name="phone" placeholder="ادخل رقم الهاتف">
                        </div>
                        
                        <div class="form-group">
                            <label for="idType" id="idTypeLabel">نوع الهوية</label>
                            <select id="idType" name="idType">
                                <option value="">اختر نوع الهوية</option>
                                <option value="national">هوية وطنية</option>
                                <option value="passport">جواز سفر</option>
                                <option value="residence">إقامة</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="idNumber" id="idNumberLabel">رقم الهوية</label>
                            <input type="text" id="idNumber" name="idNumber" placeholder="ادخل رقم الهوية">
                        </div>
                        
                        <div class="form-group">
                            <label for="company" id="companyLabel">الشركة/المؤسسة</label>
                            <input type="text" id="company" name="company" placeholder="ادخل اسم الشركة">
                        </div>
                        
                        <div class="form-group">
                            <label for="position" id="positionLabel">المنصب</label>
                            <input type="text" id="position" name="position" placeholder="ادخل المنصب">
                        </div>
                        
                        <div class="form-group">
                            <label for="visitReason" id="visitReasonLabel">سبب الزيارة</label>
                            <select id="visitReason" name="visitReason">
                                <option value="">اختر سبب الزيارة</option>
                                <option value="business">اجتماع عمل</option>
                                <option value="consultation">استشارة طبية</option>
                                <option value="meeting">اجتماع</option>
                                <option value="delivery">تسليم</option>
                                <option value="maintenance">صيانة</option>
                                <option value="training">تدريب</option>
                                <option value="interview">مقابلة</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="employeeOffice" id="employeeOfficeLabel">الموظف/المكتب المُراد زيارته</label>
                            <input type="text" id="employeeOffice" name="employeeOffice" placeholder="ادخل اسم الموظف أو المكتب">
                        </div>

                        <div class="form-group">
                            <label for="email" id="emailLabel">البريد الإلكتروني</label>
                            <input type="email" id="email" name="email" placeholder="ادخل البريد الإلكتروني">
                        </div>

                        <div class="form-group">
                            <label for="nationality" id="nationalityLabel">الجنسية</label>
                            <input type="text" id="nationality" name="nationality" placeholder="ادخل الجنسية">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes" id="notesLabel">ملاحظات إضافية</label>
                        <textarea id="notes" name="notes" placeholder="أضف أي ملاحظات إضافية هنا..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            تسجيل الزائر
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()" id="clearBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            مسح البيانات
                        </button>
                    </div>
                </form>
            </div>

            <!-- سجل الزوار والإحصائيات -->
            <div id="visitors" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalVisitors">0</h3>
                        <p id="totalLabel">إجمالي الزوار</p>
                    </div>
                    <div class="stat-card active-visitors">
                        <h3 id="activeVisitors">0</h3>
                        <p id="activeLabel">زوار نشطون</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="todayVisitors">0</h3>
                        <p id="todayLabel">زوار اليوم</p>
                    </div>
                    <div class="stat-card checked-out">
                        <h3 id="checkedOutVisitors">0</h3>
                        <p id="checkedOutLabel">تمت زيارتهم</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="weekVisitors">0</h3>
                        <p id="weekLabel">زوار هذا الأسبوع</p>
                    </div>
                </div>

                <div class="quick-actions">
                    <button class="btn btn-info" onclick="showActiveVisitors()" id="showActiveBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        عرض الزوار النشطون
                    </button>
                    <button class="btn btn-warning" onclick="showTodayVisitors()" id="showTodayBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                        </svg>
                        زوار اليوم
                    </button>
                    <button class="btn btn-secondary" onclick="showAllVisitors()" id="showAllBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                        </svg>
                        جميع الزوار
                    </button>
                </div>

                <div class="filter-section">
                    <h3 id="filterTitle">تصفية النتائج</h3>
                    <div class="date-filter">
                        <div class="form-group">
                            <label for="dateFrom" id="dateFromLabel">من تاريخ</label>
                            <input type="date" id="dateFrom">
                        </div>
                        <div class="form-group">
                            <label for="dateTo" id="dateToLabel">إلى تاريخ</label>
                            <input type="date" id="dateTo">
                        </div>
                        <div class="form-group">
                            <label for="statusFilter" id="statusFilterLabel">حالة الزيارة</label>
                            <select id="statusFilter">
                                <option value="">جميع الحالات</option>
                                <option value="active">نشط</option>
                                <option value="checked-out">تمت الزيارة</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="search-section">
                    <h3 id="searchTitle">البحث المتقدم</h3>
                    <div class="search-grid">
                        <div class="form-group">
                            <label for="searchName" id="searchNameLabel">البحث بالاسم</label>
                            <input type="text" id="searchName" placeholder="ادخل الاسم...">
                        </div>
                        <div class="form-group">
                            <label for="searchPhone" id="searchPhoneLabel">البحث برقم الهاتف</label>
                            <input type="text" id="searchPhone" placeholder="ادخل رقم الهاتف...">
                        </div>
                        <div class="form-group">
                            <label for="searchCompany" id="searchCompanyLabel">البحث بالشركة</label>
                            <input type="text" id="searchCompany" placeholder="ادخل اسم الشركة...">
                        </div>
                        <div class="form-group">
                            <label for="searchEmployee" id="searchEmployeeLabel">البحث بالموظف/المكتب</label>
                            <input type="text" id="searchEmployee" placeholder="ادخل اسم الموظف...">
                        </div>
                        <div class="form-group">
                            <label for="searchReason" id="searchReasonLabel">البحث بسبب الزيارة</label>
                            <select id="searchReason">
                                <option value="">جميع الأسباب</option>
                                <option value="business">اجتماع عمل</option>
                                <option value="consultation">استشارة طبية</option>
                                <option value="meeting">اجتماع</option>
                                <option value="delivery">تسليم</option>
                                <option value="maintenance">صيانة</option>
                                <option value="training">تدريب</option>
                                <option value="interview">مقابلة</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="searchVisitors()" id="searchBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                            بحث
                        </button>
                        <button class="btn btn-secondary" onclick="clearSearch()" id="clearSearchBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            مسح البحث
                        </button>
                    </div>
                </div>

                <div class="export-options">
                    <button class="btn btn-info" onclick="exportToPDF()" id="exportBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        تصدير PDF
                    </button>
                    <button class="btn btn-info" onclick="exportToCSV()" id="exportCSVBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        تصدير CSV
                    </button>
                    <button class="btn btn-danger" onclick="confirmClearAll()" id="clearAllBtn">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                        </svg>
                        مسح جميع البيانات
                    </button>
                </div>

                <div class="visitors-table">
                    <div id="loadingIndicator" class="loading" style="display: none;">
                        <span id="loadingText">جاري تحميل البيانات...</span>
                    </div>
                    <div id="emptyState" class="empty-state" style="display: none;">
                        <h3 id="emptyTitle">لا توجد سجلات</h3>
                        <p id="emptyMessage">لم يتم العثور على أي زوار مسجلين</p>
                    </div>
                    <div id="visitorsDisplay"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal للتأكيد -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">تأكيد الحذف</h2>
            <p id="modalMessage">هل أنت متأكد من أنك تريد حذف هذا السجل؟</p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="executeDelete()" id="confirmDeleteBtn">نعم، احذف</button>
                <button class="btn btn-secondary" onclick="closeModal()" id="cancelBtn">إلغاء</button>
            </div>
        </div>
    </div>

    <script>
        // اللغة الحالية
        let currentLanguage = 'ar';
        
        // المتغيرات العامة
        let visitors = JSON.parse(localStorage.getItem('visitors')) || [];
        let deleteIndex = -1;
        let filteredVisitors = [...visitors];
        let currentFilter = 'all';

        // النصوص باللغتين
        const translations = {
            ar: {
                headerTitle: 'نظام إدارة تسجيل الزوار',
                headerSubtitle: 'شركة MAIS للمنتجات الطبية',
                registerTab: 'تسجيل زائر جديد',
                visitorsTab: 'سجل الزوار والإحصائيات',
                fullNameLabel: 'الاسم الكامل',
                phoneLabel: 'رقم الهاتف',
                idTypeLabel: 'نوع الهوية',
                idNumberLabel: 'رقم الهوية',
                companyLabel: 'الشركة/المؤسسة',
                positionLabel: 'المنصب',
                visitReasonLabel: 'سبب الزيارة',
                employeeOfficeLabel: 'الموظف/المكتب المُراد زيارته',
                emailLabel: 'البريد الإلكتروني',
                nationalityLabel: 'الجنسية',
                notesLabel: 'ملاحظات إضافية',
                submitBtn: 'تسجيل الزائر',
                clearBtn: 'مسح البيانات',
                totalLabel: 'إجمالي الزوار',
                activeLabel: 'زوار نشطون',
                todayLabel: 'زوار اليوم',
                checkedOutLabel: 'تمت زيارتهم',
                weekLabel: 'زوار هذا الأسبوع',
                filterTitle: 'تصفية النتائج',
                dateFromLabel: 'من تاريخ',
                dateToLabel: 'إلى تاريخ',
                statusFilterLabel: 'حالة الزيارة',
                searchTitle: 'البحث المتقدم',
                searchNameLabel: 'البحث بالاسم',
                searchPhoneLabel: 'البحث برقم الهاتف',
                searchCompanyLabel: 'البحث بالشركة',
                searchEmployeeLabel: 'البحث بالموظف/المكتب',
                searchReasonLabel: 'البحث بسبب الزيارة',
                searchBtn: 'بحث',
                clearSearchBtn: 'مسح البحث',
                exportBtn: 'تصدير PDF',
                exportCSVBtn: 'تصدير CSV',
                clearAllBtn: 'مسح جميع البيانات',
                showActiveBtn: 'عرض الزوار النشطون',
                showTodayBtn: 'زوار اليوم',
                showAllBtn: 'جميع الزوار',
                loadingText: 'جاري تحميل البيانات...',
                emptyTitle: 'لا توجد سجلات',
                emptyMessage: 'لم يتم العثور على أي زوار مسجلين',
                modalTitle: 'تأكيد الحذف',
                modalMessage: 'هل أنت متأكد من أنك تريد حذف هذا السجل؟',
                confirmDeleteBtn: 'نعم، احذف',
                cancelBtn: 'إلغاء',
                successMessage: 'تم تسجيل الزائر بنجاح!',
                deleteSuccessMessage: 'تم حذف السجل بنجاح!',
                clearAllMessage: 'تم حذف جميع السجلات بنجاح!',
                checkoutSuccessMessage: 'تم تسجيل انهاء الزيارة بنجاح!',
                clearAllConfirm: 'هل أنت متأكد من أنك تريد حذف جميع سجلات الزوار؟ هذا الإجراء لا يمكن التراجع عنه!',
                langText: 'English',
                checkoutBtn: 'إنهاء الزيارة',
                deleteBtn: 'حذف',
                statusActive: 'نشط',
                statusCheckedOut: 'تمت الزيارة',
                visitDate: 'تاريخ الزيارة',
                checkoutDate: 'تاريخ إنهاء الزيارة',
                employee: 'الموظف/المكتب',
                phone: 'الهاتف',
                company: 'الشركة',
                reason: 'سبب الزيارة',
                status: 'الحالة',
                actions: 'الإجراءات'
            },
            en: {
                headerTitle: 'Visitor Management System',
                headerSubtitle: 'MAIS Medical Products Company',
                registerTab: 'Register New Visitor',
                visitorsTab: 'Visitors Log & Statistics',
                fullNameLabel: 'Full Name',
                phoneLabel: 'Phone Number',
                idTypeLabel: 'ID Type',
                idNumberLabel: 'ID Number',
                companyLabel: 'Company/Organization',
                positionLabel: 'Position',
                visitReasonLabel: 'Visit Reason',
                employeeOfficeLabel: 'Employee/Office to Visit',
                emailLabel: 'Email Address',
                nationalityLabel: 'Nationality',
                notesLabel: 'Additional Notes',
                submitBtn: 'Register Visitor',
                clearBtn: 'Clear Data',
                totalLabel: 'Total Visitors',
                activeLabel: 'Active Visitors',
                todayLabel: 'Today\'s Visitors',
                checkedOutLabel: 'Checked Out',
                weekLabel: 'This Week\'s Visitors',
                filterTitle: 'Filter Results',
                dateFromLabel: 'From Date',
                dateToLabel: 'To Date',
                statusFilterLabel: 'Visit Status',
                searchTitle: 'Advanced Search',
                searchNameLabel: 'Search by Name',
                searchPhoneLabel: 'Search by Phone',
                searchCompanyLabel: 'Search by Company',
                searchEmployeeLabel: 'Search by Employee/Office',
                searchReasonLabel: 'Search by Visit Reason',
                searchBtn: 'Search',
                clearSearchBtn: 'Clear Search',
                exportBtn: 'Export PDF',
                exportCSVBtn: 'Export CSV',
                clearAllBtn: 'Clear All Data',
                showActiveBtn: 'Show Active Visitors',
                showTodayBtn: 'Today\'s Visitors',
                showAllBtn: 'All Visitors',
                loadingText: 'Loading data...',
                emptyTitle: 'No Records Found',
                emptyMessage: 'No registered visitors found',
                modalTitle: 'Confirm Delete',
                modalMessage: 'Are you sure you want to delete this record?',
                confirmDeleteBtn: 'Yes, Delete',
                cancelBtn: 'Cancel',
                successMessage: 'Visitor registered successfully!',
                deleteSuccessMessage: 'Record deleted successfully!',
                clearAllMessage: 'All records deleted successfully!',
                checkoutSuccessMessage: 'Visit checkout recorded successfully!',
                clearAllConfirm: 'Are you sure you want to delete all visitor records? This action cannot be undone!',
                langText: 'العربية',
                checkoutBtn: 'Check Out',
                deleteBtn: 'Delete',
                statusActive: 'Active',
                statusCheckedOut: 'Checked Out',
                visitDate: 'Visit Date',
                checkoutDate: 'Checkout Date',
                employee: 'Employee/Office',
                phone: 'Phone',
                company: 'Company',
                reason: 'Visit Reason',
                status: 'Status',
                actions: 'Actions'
            }
        };

        // تحديث النصوص
        function updateTexts() {
            const texts = translations[currentLanguage];
            for (const [key, value] of Object.entries(texts)) {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = value;
                }
            }
            
            // تحديث الاتجاه
            const container = document.getElementById('container');
            if (currentLanguage === 'ar') {
                container.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('lang', 'ar');
            } else {
                container.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('lang', 'en');
            }
            
            // تحديث قوائم الاختيار
            updateSelectOptions();
        }

        // تحديث خيارات القوائم المنسدلة
        function updateSelectOptions() {
            const idTypeSelect = document.getElementById('idType');
            const visitReasonSelect = document.getElementById('visitReason');
            const searchReasonSelect = document.getElementById('searchReason');
            const statusFilterSelect = document.getElementById('statusFilter');

            if (currentLanguage === 'ar') {
                idTypeSelect.innerHTML = `
                    <option value="">اختر نوع الهوية</option>
                    <option value="national">هوية وطنية</option>
                    <option value="passport">جواز سفر</option>
                    <option value="residence">إقامة</option>
                    <option value="other">أخرى</option>
                `;
                
                visitReasonSelect.innerHTML = `
                    <option value="">اختر سبب الزيارة</option>
                    <option value="business">اجتماع عمل</option>
                    <option value="consultation">استشارة طبية</option>
                    <option value="meeting">اجتماع</option>
                    <option value="delivery">تسليم</option>
                    <option value="maintenance">صيانة</option>
                    <option value="training">تدريب</option>
                    <option value="interview">مقابلة</option>
                    <option value="other">أخرى</option>
                `;
                
                searchReasonSelect.innerHTML = `
                    <option value="">جميع الأسباب</option>
                    <option value="business">اجتماع عمل</option>
                    <option value="consultation">استشارة طبية</option>
                    <option value="meeting">اجتماع</option>
                    <option value="delivery">تسليم</option>
                    <option value="maintenance">صيانة</option>
                    <option value="training">تدريب</option>
                    <option value="interview">مقابلة</option>
                    <option value="other">أخرى</option>
                `;

                statusFilterSelect.innerHTML = `
                    <option value="">جميع الحالات</option>
                    <option value="active">نشط</option>
                    <option value="checked-out">تمت الزيارة</option>
                `;
            } else {
                idTypeSelect.innerHTML = `
                    <option value="">Select ID Type</option>
                    <option value="national">National ID</option>
                    <option value="passport">Passport</option>
                    <option value="residence">Residence Permit</option>
                    <option value="other">Other</option>
                `;
                
                visitReasonSelect.innerHTML = `
                    <option value="">Select Visit Reason</option>
                    <option value="business">Business Meeting</option>
                    <option value="consultation">Medical Consultation</option>
                    <option value="meeting">Meeting</option>
                    <option value="delivery">Delivery</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="training">Training</option>
                    <option value="interview">Interview</option>
                    <option value="other">Other</option>
                `;
                
                searchReasonSelect.innerHTML = `
                    <option value="">All Reasons</option>
                    <option value="business">Business Meeting</option>
                    <option value="consultation">Medical Consultation</option>
                    <option value="meeting">Meeting</option>
                    <option value="delivery">Delivery</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="training">Training</option>
                    <option value="interview">Interview</option>
                    <option value="other">Other</option>
                `;

                statusFilterSelect.innerHTML = `
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="checked-out">Checked Out</option>
                `;
            }
        }

        // تبديل اللغة
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            updateTexts();
            loadVisitors();
            updateStats();
        }

        // إظهار التبويب
        function showTab(tabName) {
            // إخفاء جميع التبويبات
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // إزالة الكلاس النشط من جميع الأزرار
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // إظهار التبويب المحدد
            document.getElementById(tabName).classList.add('active');
            
            // إضافة الكلاس النشط للزر المحدد
            if (tabName === 'register') {
                document.getElementById('registerTab').classList.add('active');
            } else {
                document.getElementById('visitorsTab').classList.add('active');
                loadVisitors();
                updateStats();
            }
        }

        // إرسال النموذج
        document.getElementById('visitorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const visitor = {
                id: Date.now(),
                fullName: formData.get('fullName') || '-',
                phone: formData.get('phone') || '-',
                idType: formData.get('idType') || '-',
                idNumber: formData.get('idNumber') || '-',
                company: formData.get('company') || '-',
                position: formData.get('position') || '-',
                visitReason: formData.get('visitReason') || '-',
                employeeOffice: formData.get('employeeOffice') || '-',
                email: formData.get('email') || '-',
                nationality: formData.get('nationality') || '-',
                notes: formData.get('notes') || '-',
                visitDate: new Date().toISOString(),
                status: 'active',
                checkoutDate: null
            };
            
            visitors.push(visitor);
            localStorage.setItem('visitors', JSON.stringify(visitors));
            
            showNotification(translations[currentLanguage].successMessage, 'success');
            clearForm();
            
            // التبديل تلقائياً إلى تبويب الزوار وتحديث الإحصائيات
            showTab('visitors');
            setTimeout(() => {
                updateStats();
            }, 100);
        });

        // مسح النموذج
        function clearForm() {
            document.getElementById('visitorForm').reset();
        }

        // إظهار الإشعارات
        function showNotification(message, type = 'success') {
            // إزالة الإشعارات السابقة
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // تحديث الإحصائيات
        function updateStats() {
            const total = visitors.length;
            const active = visitors.filter(v => v.status === 'active').length;
            const checkedOut = visitors.filter(v => v.status === 'checked-out').length;
            
            const today = new Date().toDateString();
            const todayCount = visitors.filter(v => 
                new Date(v.visitDate).toDateString() === today
            ).length;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekCount = visitors.filter(v => 
                new Date(v.visitDate) >= weekAgo
            ).length;
            
            document.getElementById('totalVisitors').textContent = total;
            document.getElementById('activeVisitors').textContent = active;
            document.getElementById('todayVisitors').textContent = todayCount;
            document.getElementById('checkedOutVisitors').textContent = checkedOut;
            document.getElementById('weekVisitors').textContent = weekCount;
        }

        // تحميل الزوار
        function loadVisitors() {
            const loadingDiv = document.getElementById('loadingIndicator');
            const emptyDiv = document.getElementById('emptyState');
            const displayDiv = document.getElementById('visitorsDisplay');
            
            loadingDiv.style.display = 'block';
            emptyDiv.style.display = 'none';
            displayDiv.innerHTML = '';
            
            setTimeout(() => {
                loadingDiv.style.display = 'none';
                
                if (filteredVisitors.length === 0) {
                    emptyDiv.style.display = 'block';
                } else {
                    emptyDiv.style.display = 'none';
                    renderVisitors();
                }
            }, 500);
        }

        // عرض الزوار كبطاقات
        function renderVisitors() {
            const displayDiv = document.getElementById('visitorsDisplay');
            displayDiv.innerHTML = '';
            
            filteredVisitors.forEach((visitor, index) => {
                const card = document.createElement('div');
                card.className = 'visitor-card';
                
                const visitDate = new Date(visitor.visitDate);
                const formattedVisitDate = visitDate.toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US') + 
                                         ' ' + visitDate.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                
                let checkoutInfo = '';
                if (visitor.checkoutDate) {
                    const checkoutDate = new Date(visitor.checkoutDate);
                    const formattedCheckoutDate = checkoutDate.toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US') + 
                                                 ' ' + checkoutDate.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                    checkoutInfo = `
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].checkoutDate}:</strong> ${formattedCheckoutDate}
                        </div>
                    `;
                }
                
                const idTypeText = getIdTypeText(visitor.idType);
                const reasonText = getReasonText(visitor.visitReason);
                const statusText = visitor.status === 'active' ? 
                    translations[currentLanguage].statusActive : 
                    translations[currentLanguage].statusCheckedOut;
                
                card.innerHTML = `
                    <h4>${visitor.fullName}</h4>
                    <div class="visitor-details">
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].phone}:</strong> ${visitor.phone}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].company}:</strong> ${visitor.company}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].employee}:</strong> ${visitor.employeeOffice}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].reason}:</strong> ${reasonText}
                        </div>
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].visitDate}:</strong> ${formattedVisitDate}
                        </div>
                        ${checkoutInfo}
                        <div class="visitor-detail">
                            <strong>${translations[currentLanguage].status}:</strong> 
                            <span class="status-badge ${visitor.status === 'active' ? 'status-active' : 'status-checked-out'}">${statusText}</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        ${visitor.status === 'active' ? `
                            <button class="action-btn checkout-btn" onclick="checkoutVisitor(${visitors.indexOf(visitor)})">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                </svg>
                                ${translations[currentLanguage].checkoutBtn}
                            </button>
                        ` : ''}
                        <button class="action-btn delete-btn" onclick="confirmDelete(${visitors.indexOf(visitor)})">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                            </svg>
                            ${translations[currentLanguage].deleteBtn}
                        </button>
                    </div>
                `;
                
                displayDiv.appendChild(card);
            });
        }

        // إنهاء زيارة
        function checkoutVisitor(index) {
            visitors[index].status = 'checked-out';
            visitors[index].checkoutDate = new Date().toISOString();
            localStorage.setItem('visitors', JSON.stringify(visitors));
            
            showNotification(translations[currentLanguage].checkoutSuccessMessage, 'success');
            applyCurrentFilter();
            updateStats();
        }

        // عرض الزوار النشطون
        function showActiveVisitors() {
            currentFilter = 'active';
            filteredVisitors = visitors.filter(v => v.status === 'active');
            loadVisitors();
        }

        // عرض زوار اليوم
        function showTodayVisitors() {
            currentFilter = 'today';
            const today = new Date().toDateString();
            filteredVisitors = visitors.filter(v => 
                new Date(v.visitDate).toDateString() === today
            );
            loadVisitors();
        }

        // عرض جميع الزوار
        function showAllVisitors() {
            currentFilter = 'all';
            filteredVisitors = [...visitors];
            loadVisitors();
        }

        // تطبيق الفلتر الحالي
        function applyCurrentFilter() {
            switch (currentFilter) {
                case 'active':
                    showActiveVisitors();
                    break;
                case 'today':
                    showTodayVisitors();
                    break;
                default:
                    showAllVisitors();
                    break;
            }
        }

        // الحصول على نص نوع الهوية
        function getIdTypeText(idType) {
            const texts = {
                ar: {
                    national: 'هوية وطنية',
                    passport: 'جواز سفر',
                    residence: 'إقامة',
                    other: 'أخرى'
                },
                en: {
                    national: 'National ID',
                    passport: 'Passport',
                    residence: 'Residence Permit',
                    other: 'Other'
                }
            };
            return texts[currentLanguage][idType] || idType;
        }

        // الحصول على نص سبب الزيارة
        function getReasonText(reason) {
            const texts = {
                ar: {
                    business: 'اجتماع عمل',
                    consultation: 'استشارة طبية',
                    meeting: 'اجتماع',
                    delivery: 'تسليم',
                    maintenance: 'صيانة',
                    training: 'تدريب',
                    interview: 'مقابلة',
                    other: 'أخرى'
                },
                en: {
                    business: 'Business Meeting',
                    consultation: 'Medical Consultation',
                    meeting: 'Meeting',
                    delivery: 'Delivery',
                    maintenance: 'Maintenance',
                    training: 'Training',
                    interview: 'Interview',
                    other: 'Other'
                }
            };
            return texts[currentLanguage][reason] || reason;
        }

        // تأكيد الحذف
        function confirmDelete(index) {
            deleteIndex = index;
            document.getElementById('confirmModal').style.display = 'block';
        }

        // تنفيذ الحذف
        function executeDelete() {
            if (deleteIndex >= 0) {
                visitors.splice(deleteIndex, 1);
                localStorage.setItem('visitors', JSON.stringify(visitors));
                
                showNotification(translations[currentLanguage].deleteSuccessMessage, 'success');
                applyCurrentFilter();
                updateStats();
            }
            closeModal();
        }

        // إغلاق النافذة المنبثقة
        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
            deleteIndex = -1;
        }

        // تأكيد مسح جميع البيانات
        function confirmClearAll() {
            const confirmed = confirm(translations[currentLanguage].clearAllConfirm);
            if (confirmed) {
                visitors = [];
                filteredVisitors = [];
                localStorage.setItem('visitors', JSON.stringify(visitors));
                
                showNotification(translations[currentLanguage].clearAllMessage, 'success');
                loadVisitors();
                updateStats();
            }
        }

        // البحث في الزوار
        function searchVisitors() {
            const name = document.getElementById('searchName').value.toLowerCase();
            const phone = document.getElementById('searchPhone').value.toLowerCase();
            const company = document.getElementById('searchCompany').value.toLowerCase();
            const employee = document.getElementById('searchEmployee').value.toLowerCase();
            const reason = document.getElementById('searchReason').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            filteredVisitors = visitors.filter(visitor => {
                const matchName = !name || visitor.fullName.toLowerCase().includes(name);
                const matchPhone = !phone || visitor.phone.toLowerCase().includes(phone);
                const matchCompany = !company || visitor.company.toLowerCase().includes(company);
                const matchEmployee = !employee || visitor.employeeOffice.toLowerCase().includes(employee);
                const matchReason = !reason || visitor.visitReason === reason;
                const matchStatus = !statusFilter || visitor.status === statusFilter;
                
                let matchDate = true;
                if (dateFrom || dateTo) {
                    const visitDate = new Date(visitor.visitDate).toDateString();
                    if (dateFrom) {
                        matchDate = matchDate && new Date(visitDate) >= new Date(dateFrom);
                    }
                    if (dateTo) {
                        matchDate = matchDate && new Date(visitDate) <= new Date(dateTo);
                    }
                }
                
                return matchName && matchPhone && matchCompany && matchEmployee && matchReason && matchStatus && matchDate;
            });
            
            currentFilter = 'search';
            loadVisitors();
        }

        // مسح البحث
        function clearSearch() {
            document.getElementById('searchName').value = '';
            document.getElementById('searchPhone').value = '';
            document.getElementById('searchCompany').value = '';
            document.getElementById('searchEmployee').value = '';
            document.getElementById('searchReason').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('statusFilter').value = '';
            
            showAllVisitors();
        }

        // تصدير إلى PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont('helvetica');
            
            const title = currentLanguage === 'ar' ? 
                'تقرير سجل الزوار - شركة MAIS' : 
                'Visitors Log Report - MAIS Company';
            
            doc.setFontSize(16);
            doc.text(title, 20, 20);
            
            const date = new Date().toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
            doc.setFontSize(12);
            doc.text(`${currentLanguage === 'ar' ? 'تاريخ التقرير: ' : 'Report Date: '}${date}`, 20, 35);
            
            let yPos = 50;
            
            filteredVisitors.forEach((visitor, index) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                const visitDate = new Date(visitor.visitDate).toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                const idTypeText = getIdTypeText(visitor.idType);
                const reasonText = getReasonText(visitor.visitReason);
                const statusText = visitor.status === 'active' ? 
                    translations[currentLanguage].statusActive : 
                    translations[currentLanguage].statusCheckedOut;
                
                doc.text(`${index + 1}. ${visitor.fullName}`, 20, yPos);
                doc.text(`${currentLanguage === 'ar' ? 'الهاتف: ' : 'Phone: '}${visitor.phone}`, 20, yPos + 10);
                doc.text(`${currentLanguage === 'ar' ? 'الشركة: ' : 'Company: '}${visitor.company}`, 20, yPos + 20);
                doc.text(`${currentLanguage === 'ar' ? 'الموظف/المكتب: ' : 'Employee/Office: '}${visitor.employeeOffice}`, 20, yPos + 30);
                doc.text(`${currentLanguage === 'ar' ? 'سبب الزيارة: ' : 'Visit Reason: '}${reasonText}`, 20, yPos + 40);
                doc.text(`${currentLanguage === 'ar' ? 'الحالة: ' : 'Status: '}${statusText}`, 20, yPos + 50);
                doc.text(`${currentLanguage === 'ar' ? 'التاريخ: ' : 'Date: '}${visitDate}`, 20, yPos + 60);
                
                yPos += 75;
            });
            
            doc.save('visitors_report.pdf');
        }

        // تصدير إلى CSV
        function exportToCSV() {
            const csvContent = [
                [
                    currentLanguage === 'ar' ? 'الاسم' : 'Name',
                    currentLanguage === 'ar' ? 'الهاتف' : 'Phone',
                    currentLanguage === 'ar' ? 'الشركة' : 'Company',
                    currentLanguage === 'ar' ? 'الموظف/المكتب' : 'Employee/Office',
                    currentLanguage === 'ar' ? 'سبب الزيارة' : 'Visit Reason',
                    currentLanguage === 'ar' ? 'الحالة' : 'Status',
                    currentLanguage === 'ar' ? 'تاريخ الزيارة' : 'Visit Date',
                    currentLanguage === 'ar' ? 'تاريخ إنهاء الزيارة' : 'Checkout Date'
                ].join(',')
            ];

            filteredVisitors.forEach(visitor => {
                const visitDate = new Date(visitor.visitDate).toLocaleDateString();
                const checkoutDate = visitor.checkoutDate ? new Date(visitor.checkoutDate).toLocaleDateString() : '-';
                const reasonText = getReasonText(visitor.visitReason);
                const statusText = visitor.status === 'active' ? 
                    translations[currentLanguage].statusActive : 
                    translations[currentLanguage].statusCheckedOut;

                csvContent.push([
                    visitor.fullName,
                    visitor.phone,
                    visitor.company,
                    visitor.employeeOffice,
                    reasonText,
                    statusText,
                    visitDate,
                    checkoutDate
                ].join(','));
            });

            const blob = new Blob([csvContent.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'visitors_report.csv';
            link.click();
        }

        // إضافة مستمعي الأحداث للبحث والفلترة
        document.getElementById('searchName').addEventListener('input', searchVisitors);
        document.getElementById('searchPhone').addEventListener('input', searchVisitors);
        document.getElementById('searchCompany').addEventListener('input', searchVisitors);
        document.getElementById('searchEmployee').addEventListener('input', searchVisitors);
        document.getElementById('searchReason').addEventListener('change', searchVisitors);
        document.getElementById('dateFrom').addEventListener('change', searchVisitors);
        document.getElementById('dateTo').addEventListener('change', searchVisitors);
        document.getElementById('statusFilter').addEventListener('change', searchVisitors);

        // إغلاق النافذة المنبثقة عند النقر خارجها
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            updateTexts();
            filteredVisitors = [...visitors];
            updateStats();
        });
    </script>
</body>
</html>