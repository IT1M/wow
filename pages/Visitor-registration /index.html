<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة تسجيل الزوار - MAIS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .language-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            padding: 30px;
        }

        .nav-tabs {
            display: flex;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            transform: translateY(-3px);
        }

        .tab-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .tab-btn.active:hover {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2E8B57;
            background: white;
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
            transform: translateY(-2px);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 3rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .stat-card p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .visitors-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #e9ecef;
        }

        .table th {
            background: linear-gradient(45deg, #2E8B57, #3CB371);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2E8B57;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            color: #dc3545;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .modal p {
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .table {
                font-size: 0.9rem;
            }
            
            .table th,
            .table td {
                padding: 10px 8px;
            }
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .table-responsive {
            overflow-x: auto;
        }

        /* English styles */
        .container[dir="ltr"] {
            direction: ltr;
        }

        .container[dir="ltr"] .table th,
        .container[dir="ltr"] .table td {
            text-align: left;
        }

        .container[dir="ltr"] .language-toggle {
            left: auto;
            right: 20px;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <header class="header">
            <button class="language-toggle" onclick="toggleLanguage()">
                <span id="langText">English</span>
            </button>
            <h1 id="headerTitle">نظام إدارة تسجيل الزوار</h1>
            <p id="headerSubtitle">شركة MAIS للمنتجات الطبية</p>
        </header>

        <main class="main-content">
            <nav class="nav-tabs">
                <button class="tab-btn active" onclick="showTab('register')" id="registerTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    تسجيل زائر جديد
                </button>
                <button class="tab-btn" onclick="showTab('visitors')" id="visitorsTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                    </svg>
                    سجل الزوار والإحصائيات
                </button>
            </nav>

            <div id="successMessage" class="success-message" style="display: none;"></div>

            <!-- تسجيل زائر جديد -->
            <div id="register" class="tab-content active">
                <form id="visitorForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fullName" id="fullNameLabel">الاسم الكامل *</label>
                            <input type="text" id="fullName" name="fullName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" id="phoneLabel">رقم الهاتف *</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="idType" id="idTypeLabel">نوع الهوية *</label>
                            <select id="idType" name="idType" required>
                                <option value="">اختر نوع الهوية</option>
                                <option value="national">هوية وطنية</option>
                                <option value="passport">جواز سفر</option>
                                <option value="residence">إقامة</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="idNumber" id="idNumberLabel">رقم الهوية *</label>
                            <input type="text" id="idNumber" name="idNumber" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="company" id="companyLabel">الشركة/المؤسسة</label>
                            <input type="text" id="company" name="company">
                        </div>
                        
                        <div class="form-group">
                            <label for="position" id="positionLabel">المنصب</label>
                            <input type="text" id="position" name="position">
                        </div>
                        
                        <div class="form-group">
                            <label for="visitReason" id="visitReasonLabel">سبب الزيارة *</label>
                            <select id="visitReason" name="visitReason" required>
                                <option value="">اختر سبب الزيارة</option>
                                <option value="business">اجتماع عمل</option>
                                <option value="consultation">استشارة طبية</option>
                                <option value="meeting">اجتماع</option>
                                <option value="delivery">تسليم</option>
                                <option value="maintenance">صيانة</option>
                                <option value="training">تدريب</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes" id="notesLabel">ملاحظات إضافية</label>
                        <textarea id="notes" name="notes" placeholder="أضف أي ملاحظات إضافية هنا..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            تسجيل الزائر
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()" id="clearBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            مسح البيانات
                        </button>
                    </div>
                </form>
            </div>

            <!-- سجل الزوار والإحصائيات -->
            <div id="visitors" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalVisitors">0</h3>
                        <p id="totalLabel">إجمالي الزوار</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="todayVisitors">0</h3>
                        <p id="todayLabel">زوار اليوم</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="weekVisitors">0</h3>
                        <p id="weekLabel">زوار هذا الأسبوع</p>
                    </div>
                </div>

                <div class="search-section">
                    <h3 id="searchTitle">البحث المتقدم</h3>
                    <div class="search-grid">
                        <div class="form-group">
                            <label for="searchName" id="searchNameLabel">البحث بالاسم</label>
                            <input type="text" id="searchName" placeholder="ادخل الاسم...">
                        </div>
                        <div class="form-group">
                            <label for="searchPhone" id="searchPhoneLabel">البحث برقم الهاتف</label>
                            <input type="text" id="searchPhone" placeholder="ادخل رقم الهاتف...">
                        </div>
                        <div class="form-group">
                            <label for="searchCompany" id="searchCompanyLabel">البحث بالشركة</label>
                            <input type="text" id="searchCompany" placeholder="ادخل اسم الشركة...">
                        </div>
                        <div class="form-group">
                            <label for="searchReason" id="searchReasonLabel">البحث بسبب الزيارة</label>
                            <select id="searchReason">
                                <option value="">جميع الأسباب</option>
                                <option value="business">اجتماع عمل</option>
                                <option value="consultation">استشارة طبية</option>
                                <option value="meeting">اجتماع</option>
                                <option value="delivery">تسليم</option>
                                <option value="maintenance">صيانة</option>
                                <option value="training">تدريب</option>
                                <option value="other">أخرى</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="searchVisitors()" id="searchBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                            بحث
                        </button>
                        <button class="btn btn-secondary" onclick="clearSearch()" id="clearSearchBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            مسح البحث
                        </button>
                        <button class="btn btn-info" onclick="exportToPDF()" id="exportBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            تصدير PDF
                        </button>
                        <button class="btn btn-danger" onclick="confirmClearAll()" id="clearAllBtn">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                            </svg>
                            مسح جميع البيانات
                        </button>
                    </div>
                </div>

                <div class="visitors-table">
                    <div id="loadingIndicator" class="loading" style="display: none;">
                        <span id="loadingText">جاري تحميل البيانات...</span>
                    </div>
                    <div id="emptyState" class="empty-state" style="display: none;">
                        <h3 id="emptyTitle">لا توجد سجلات</h3>
                        <p id="emptyMessage">لم يتم العثور على أي زوار مسجلين</p>
                    </div>
                    <div class="table-responsive">
                        <table class="table" id="visitorsTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th id="nameHeader">الاسم</th>
                                    <th id="phoneHeader">الهاتف</th>
                                    <th id="idHeader">نوع الهوية</th>
                                    <th id="companyHeader">الشركة</th>
                                    <th id="reasonHeader">سبب الزيارة</th>
                                    <th id="dateHeader">تاريخ الزيارة</th>
                                    <th id="actionHeader">إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="visitorsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal للتأكيد -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">تأكيد الحذف</h2>
            <p id="modalMessage">هل أنت متأكد من أنك تريد حذف هذا السجل؟</p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="executeDelete()" id="confirmDeleteBtn">نعم، احذف</button>
                <button class="btn btn-secondary" onclick="closeModal()" id="cancelBtn">إلغاء</button>
            </div>
        </div>
    </div>

    <script>
        // اللغة الحالية
        let currentLanguage = 'ar';
        
        // المتغيرات العامة
        let visitors = JSON.parse(localStorage.getItem('visitors')) || [];
        let deleteIndex = -1;
        let filteredVisitors = [...visitors];

        // النصوص باللغتين
        const translations = {
            ar: {
                headerTitle: 'نظام إدارة تسجيل الزوار',
                headerSubtitle: 'شركة MAIS للمنتجات الطبية',
                registerTab: 'تسجيل زائر جديد',
                visitorsTab: 'سجل الزوار والإحصائيات',
                fullNameLabel: 'الاسم الكامل *',
                phoneLabel: 'رقم الهاتف *',
                idTypeLabel: 'نوع الهوية *',
                idNumberLabel: 'رقم الهوية *',
                companyLabel: 'الشركة/المؤسسة',
                positionLabel: 'المنصب',
                visitReasonLabel: 'سبب الزيارة *',
                notesLabel: 'ملاحظات إضافية',
                submitBtn: 'تسجيل الزائر',
                clearBtn: 'مسح البيانات',
                totalLabel: 'إجمالي الزوار',
                todayLabel: 'زوار اليوم',
                weekLabel: 'زوار هذا الأسبوع',
                searchTitle: 'البحث المتقدم',
                searchNameLabel: 'البحث بالاسم',
                searchPhoneLabel: 'البحث برقم الهاتف',
                searchCompanyLabel: 'البحث بالشركة',
                searchReasonLabel: 'البحث بسبب الزيارة',
                searchBtn: 'بحث',
                clearSearchBtn: 'مسح البحث',
                exportBtn: 'تصدير PDF',
                clearAllBtn: 'مسح جميع البيانات',
                nameHeader: 'الاسم',
                phoneHeader: 'الهاتف',
                idHeader: 'نوع الهوية',
                companyHeader: 'الشركة',
                reasonHeader: 'سبب الزيارة',
                dateHeader: 'تاريخ الزيارة',
                actionHeader: 'إجراءات',
                loadingText: 'جاري تحميل البيانات...',
                emptyTitle: 'لا توجد سجلات',
                emptyMessage: 'لم يتم العثور على أي زوار مسجلين',
                modalTitle: 'تأكيد الحذف',
                modalMessage: 'هل أنت متأكد من أنك تريد حذف هذا السجل؟',
                confirmDeleteBtn: 'نعم، احذف',
                cancelBtn: 'إلغاء',
                successMessage: 'تم تسجيل الزائر بنجاح!',
                deleteSuccessMessage: 'تم حذف السجل بنجاح!',
                clearAllMessage: 'تم حذف جميع السجلات بنجاح!',
                clearAllConfirm: 'هل أنت متأكد من أنك تريد حذف جميع سجلات الزوار؟ هذا الإجراء لا يمكن التراجع عنه!',
                langText: 'English'
            },
            en: {
                headerTitle: 'Visitor Management System',
                headerSubtitle: 'MAIS Medical Products Company',
                registerTab: 'Register New Visitor',
                visitorsTab: 'Visitors Log & Statistics',
                fullNameLabel: 'Full Name *',
                phoneLabel: 'Phone Number *',
                idTypeLabel: 'ID Type *',
                idNumberLabel: 'ID Number *',
                companyLabel: 'Company/Organization',
                positionLabel: 'Position',
                visitReasonLabel: 'Visit Reason *',
                notesLabel: 'Additional Notes',
                submitBtn: 'Register Visitor',
                clearBtn: 'Clear Data',
                totalLabel: 'Total Visitors',
                todayLabel: 'Today\'s Visitors',
                weekLabel: 'This Week\'s Visitors',
                searchTitle: 'Advanced Search',
                searchNameLabel: 'Search by Name',
                searchPhoneLabel: 'Search by Phone',
                searchCompanyLabel: 'Search by Company',
                searchReasonLabel: 'Search by Visit Reason',
                searchBtn: 'Search',
                clearSearchBtn: 'Clear Search',
                exportBtn: 'Export PDF',
                clearAllBtn: 'Clear All Data',
                nameHeader: 'Name',
                phoneHeader: 'Phone',
                idHeader: 'ID Type',
                companyHeader: 'Company',
                reasonHeader: 'Visit Reason',
                dateHeader: 'Visit Date',
                actionHeader: 'Actions',
                loadingText: 'Loading data...',
                emptyTitle: 'No Records Found',
                emptyMessage: 'No registered visitors found',
                modalTitle: 'Confirm Delete',
                modalMessage: 'Are you sure you want to delete this record?',
                confirmDeleteBtn: 'Yes, Delete',
                cancelBtn: 'Cancel',
                successMessage: 'Visitor registered successfully!',
                deleteSuccessMessage: 'Record deleted successfully!',
                clearAllMessage: 'All records deleted successfully!',
                clearAllConfirm: 'Are you sure you want to delete all visitor records? This action cannot be undone!',
                langText: 'العربية'
            }
        };

        // تحديث النصوص
        function updateTexts() {
            const texts = translations[currentLanguage];
            for (const [key, value] of Object.entries(texts)) {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = value;
                }
            }
            
            // تحديث الاتجاه
            const container = document.getElementById('container');
            if (currentLanguage === 'ar') {
                container.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('dir', 'rtl');
                document.documentElement.setAttribute('lang', 'ar');
            } else {
                container.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('dir', 'ltr');
                document.documentElement.setAttribute('lang', 'en');
            }
            
            // تحديث قوائم الاختيار
            updateSelectOptions();
        }

        // تحديث خيارات القوائم المنسدلة
        function updateSelectOptions() {
            const idTypeSelect = document.getElementById('idType');
            const visitReasonSelect = document.getElementById('visitReason');
            const searchReasonSelect = document.getElementById('searchReason');

            if (currentLanguage === 'ar') {
                idTypeSelect.innerHTML = `
                    <option value="">اختر نوع الهوية</option>
                    <option value="national">هوية وطنية</option>
                    <option value="passport">جواز سفر</option>
                    <option value="residence">إقامة</option>
                `;
                
                visitReasonSelect.innerHTML = `
                    <option value="">اختر سبب الزيارة</option>
                    <option value="business">اجتماع عمل</option>
                    <option value="consultation">استشارة طبية</option>
                    <option value="meeting">اجتماع</option>
                    <option value="delivery">تسليم</option>
                    <option value="maintenance">صيانة</option>
                    <option value="training">تدريب</option>
                    <option value="other">أخرى</option>
                `;
                
                searchReasonSelect.innerHTML = `
                    <option value="">جميع الأسباب</option>
                    <option value="business">اجتماع عمل</option>
                    <option value="consultation">استشارة طبية</option>
                    <option value="meeting">اجتماع</option>
                    <option value="delivery">تسليم</option>
                    <option value="maintenance">صيانة</option>
                    <option value="training">تدريب</option>
                    <option value="other">أخرى</option>
                `;
            } else {
                idTypeSelect.innerHTML = `
                    <option value="">Select ID Type</option>
                    <option value="national">National ID</option>
                    <option value="passport">Passport</option>
                    <option value="residence">Residence Permit</option>
                `;
                
                visitReasonSelect.innerHTML = `
                    <option value="">Select Visit Reason</option>
                    <option value="business">Business Meeting</option>
                    <option value="consultation">Medical Consultation</option>
                    <option value="meeting">Meeting</option>
                    <option value="delivery">Delivery</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="training">Training</option>
                    <option value="other">Other</option>
                `;
                
                searchReasonSelect.innerHTML = `
                    <option value="">All Reasons</option>
                    <option value="business">Business Meeting</option>
                    <option value="consultation">Medical Consultation</option>
                    <option value="meeting">Meeting</option>
                    <option value="delivery">Delivery</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="training">Training</option>
                    <option value="other">Other</option>
                `;
            }
        }

        // تبديل اللغة
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            updateTexts();
            loadVisitors();
            updateStats();
        }

        // إظهار التبويب
        function showTab(tabName) {
            // إخفاء جميع التبويبات
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // إزالة الكلاس النشط من جميع الأزرار
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // إظهار التبويب المحدد
            document.getElementById(tabName).classList.add('active');
            
            // إضافة الكلاس النشط للزر المحدد
            if (tabName === 'register') {
                document.getElementById('registerTab').classList.add('active');
            } else {
                document.getElementById('visitorsTab').classList.add('active');
                loadVisitors();
                updateStats();
            }
        }

        // إرسال النموذج
        document.getElementById('visitorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const visitor = {
                id: Date.now(),
                fullName: formData.get('fullName'),
                phone: formData.get('phone'),
                idType: formData.get('idType'),
                idNumber: formData.get('idNumber'),
                company: formData.get('company') || '-',
                position: formData.get('position') || '-',
                visitReason: formData.get('visitReason'),
                notes: formData.get('notes') || '-',
                visitDate: new Date().toISOString()
            };
            
            visitors.push(visitor);
            localStorage.setItem('visitors', JSON.stringify(visitors));
            
            showSuccessMessage(translations[currentLanguage].successMessage);
            clearForm();
        });

        // مسح النموذج
        function clearForm() {
            document.getElementById('visitorForm').reset();
        }

        // إظهار رسالة النجاح
        function showSuccessMessage(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // تحديث الإحصائيات
        function updateStats() {
            const total = visitors.length;
            const today = new Date().toDateString();
            const todayCount = visitors.filter(v => 
                new Date(v.visitDate).toDateString() === today
            ).length;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekCount = visitors.filter(v => 
                new Date(v.visitDate) >= weekAgo
            ).length;
            
            document.getElementById('totalVisitors').textContent = total;
            document.getElementById('todayVisitors').textContent = todayCount;
            document.getElementById('weekVisitors').textContent = weekCount;
        }

        // تحميل الزوار
        function loadVisitors() {
            const loadingDiv = document.getElementById('loadingIndicator');
            const emptyDiv = document.getElementById('emptyState');
            const table = document.getElementById('visitorsTable');
            
            loadingDiv.style.display = 'block';
            emptyDiv.style.display = 'none';
            table.style.display = 'none';
            
            setTimeout(() => {
                loadingDiv.style.display = 'none';
                
                if (filteredVisitors.length === 0) {
                    emptyDiv.style.display = 'block';
                } else {
                    table.style.display = 'table';
                    renderVisitorsTable();
                }
            }, 500);
        }

        // عرض جدول الزوار
        function renderVisitorsTable() {
            const tbody = document.getElementById('visitorsTableBody');
            tbody.innerHTML = '';
            
            filteredVisitors.forEach((visitor, index) => {
                const row = document.createElement('tr');
                
                const date = new Date(visitor.visitDate);
                const formattedDate = date.toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US') + 
                                   ' ' + date.toLocaleTimeString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                
                const idTypeText = getIdTypeText(visitor.idType);
                const reasonText = getReasonText(visitor.visitReason);
                
                row.innerHTML = `
                    <td>${visitor.fullName}</td>
                    <td>${visitor.phone}</td>
                    <td>${idTypeText}</td>
                    <td>${visitor.company}</td>
                    <td>${reasonText}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <button class="delete-btn" onclick="confirmDelete(${visitors.indexOf(visitor)})">
                            ${currentLanguage === 'ar' ? 'حذف' : 'Delete'}
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // الحصول على نص نوع الهوية
        function getIdTypeText(idType) {
            const texts = {
                ar: {
                    national: 'هوية وطنية',
                    passport: 'جواز سفر',
                    residence: 'إقامة'
                },
                en: {
                    national: 'National ID',
                    passport: 'Passport',
                    residence: 'Residence Permit'
                }
            };
            return texts[currentLanguage][idType] || idType;
        }

        // الحصول على نص سبب الزيارة
        function getReasonText(reason) {
            const texts = {
                ar: {
                    business: 'اجتماع عمل',
                    consultation: 'استشارة طبية',
                    meeting: 'اجتماع',
                    delivery: 'تسليم',
                    maintenance: 'صيانة',
                    training: 'تدريب',
                    other: 'أخرى'
                },
                en: {
                    business: 'Business Meeting',
                    consultation: 'Medical Consultation',
                    meeting: 'Meeting',
                    delivery: 'Delivery',
                    maintenance: 'Maintenance',
                    training: 'Training',
                    other: 'Other'
                }
            };
            return texts[currentLanguage][reason] || reason;
        }

        // تأكيد الحذف
        function confirmDelete(index) {
            deleteIndex = index;
            document.getElementById('confirmModal').style.display = 'block';
        }

        // تنفيذ الحذف
        function executeDelete() {
            if (deleteIndex >= 0) {
                visitors.splice(deleteIndex, 1);
                localStorage.setItem('visitors', JSON.stringify(visitors));
                filteredVisitors = [...visitors];
                
                showSuccessMessage(translations[currentLanguage].deleteSuccessMessage);
                loadVisitors();
                updateStats();
            }
            closeModal();
        }

        // إغلاق النافذة المنبثقة
        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
            deleteIndex = -1;
        }

        // تأكيد مسح جميع البيانات
        function confirmClearAll() {
            const confirmed = confirm(translations[currentLanguage].clearAllConfirm);
            if (confirmed) {
                visitors = [];
                filteredVisitors = [];
                localStorage.setItem('visitors', JSON.stringify(visitors));
                
                showSuccessMessage(translations[currentLanguage].clearAllMessage);
                loadVisitors();
                updateStats();
            }
        }

        // البحث في الزوار
        function searchVisitors() {
            const name = document.getElementById('searchName').value.toLowerCase();
            const phone = document.getElementById('searchPhone').value.toLowerCase();
            const company = document.getElementById('searchCompany').value.toLowerCase();
            const reason = document.getElementById('searchReason').value;
            
            filteredVisitors = visitors.filter(visitor => {
                const matchName = !name || visitor.fullName.toLowerCase().includes(name);
                const matchPhone = !phone || visitor.phone.toLowerCase().includes(phone);
                const matchCompany = !company || visitor.company.toLowerCase().includes(company);
                const matchReason = !reason || visitor.visitReason === reason;
                
                return matchName && matchPhone && matchCompany && matchReason;
            });
            
            loadVisitors();
        }

        // مسح البحث
        function clearSearch() {
            document.getElementById('searchName').value = '';
            document.getElementById('searchPhone').value = '';
            document.getElementById('searchCompany').value = '';
            document.getElementById('searchReason').value = '';
            
            filteredVisitors = [...visitors];
            loadVisitors();
        }

        // تصدير إلى PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // إعداد الخط للعربية (إذا كان متاحًا)
            doc.setFont('helvetica');
            
            const title = currentLanguage === 'ar' ? 
                'تقرير سجل الزوار - شركة MAIS' : 
                'Visitors Log Report - MAIS Company';
            
            doc.setFontSize(16);
            doc.text(title, 20, 20);
            
            const date = new Date().toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
            doc.setFontSize(12);
            doc.text(`${currentLanguage === 'ar' ? 'تاريخ التقرير: ' : 'Report Date: '}${date}`, 20, 35);
            
            let yPos = 50;
            
            filteredVisitors.forEach((visitor, index) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                const visitDate = new Date(visitor.visitDate).toLocaleDateString(currentLanguage === 'ar' ? 'ar-SA' : 'en-US');
                const idTypeText = getIdTypeText(visitor.idType);
                const reasonText = getReasonText(visitor.visitReason);
                
                doc.text(`${index + 1}. ${visitor.fullName}`, 20, yPos);
                doc.text(`${currentLanguage === 'ar' ? 'الهاتف: ' : 'Phone: '}${visitor.phone}`, 20, yPos + 10);
                doc.text(`${currentLanguage === 'ar' ? 'الشركة: ' : 'Company: '}${visitor.company}`, 20, yPos + 20);
                doc.text(`${currentLanguage === 'ar' ? 'سبب الزيارة: ' : 'Visit Reason: '}${reasonText}`, 20, yPos + 30);
                doc.text(`${currentLanguage === 'ar' ? 'التاريخ: ' : 'Date: '}${visitDate}`, 20, yPos + 40);
                
                yPos += 55;
            });
            
            doc.save('visitors_report.pdf');
        }

        // إضافة مستمعي الأحداث للبحث
        document.getElementById('searchName').addEventListener('input', searchVisitors);
        document.getElementById('searchPhone').addEventListener('input', searchVisitors);
        document.getElementById('searchCompany').addEventListener('input', searchVisitors);
        document.getElementById('searchReason').addEventListener('change', searchVisitors);

        // إغلاق النافذة المنبثقة عند النقر خارجها
        window.onclick = function(event) {
            const modal = document.getElementById('confirmModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            updateTexts();
            filteredVisitors = [...visitors];
            updateStats();
        });
    </script>
</body>
</html>